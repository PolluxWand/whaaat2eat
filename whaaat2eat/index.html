<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>ÈÄâ‰∫Ü‰πà - ‰ªäÂ§©ÂêÉ‰ªÄ‰πà</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'selector', 
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', '"Helvetica Neue"', 'Arial', '"Noto Sans"', 'sans-serif', '"Apple Color Emoji"', '"Segoe UI Emoji"', '"Segoe UI Symbol"', '"Noto Color Emoji"'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    
    <!-- React & Babel -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    
    <!-- Screenshot Tool -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <style>
        /* Base Styles */
        body {
            background-color: #f5f5f5;
            color: #000000;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .dark body {
            background-color: #000000;
            color: #ffffff;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Sticker Effect */
        .sticker-effect {
            filter: 
                drop-shadow(0px -2px 0px white) 
                drop-shadow(2px 0px 0px white) 
                drop-shadow(0px 2px 0px white) 
                drop-shadow(-2px 0px 0px white)
                drop-shadow(0 4px 8px rgba(0,0,0,0.5));
            transition: transform 0.3s ease;
        }
        .sticker-effect:active { transform: scale(0.95); }

        /* Loader */
        .loader {
            border: 3px solid #e5e5e5;
            border-top: 3px solid #000;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        .dark .loader {
            border: 3px solid #333;
            border-top: 3px solid #fff;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #loading-screen {
            position: fixed; inset: 0; background: #fff; z-index: 9999;
            display: flex; justify-content: center; align-items: center; transition: opacity 0.5s;
        }
        .dark #loading-screen { background: #000; }
    </style>
</head>
<body>
    <div id="loading-screen"><div class="loader"></div></div>
    <div id="root"></div>

    <script type="text/babel">
        // --- 0. PREAMBLE & UTILS ---
        const { useState, useEffect, useRef, useMemo, useCallback } = React;
        
        // Hide loader
        setTimeout(() => {
            const el = document.getElementById('loading-screen');
            if(el) { el.style.opacity = '0'; setTimeout(()=>el.remove(), 500); }
        }, 500);

        // --- AUDIO ENGINE (Realistic Ratchet) ---
        const AudioEngine = {
            ctx: null,
            init: () => {
                if (!AudioEngine.ctx) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) AudioEngine.ctx = new AudioContext();
                }
            },
            resume: () => {
                if (AudioEngine.ctx && AudioEngine.ctx.state === 'suspended') {
                    AudioEngine.ctx.resume();
                }
            },
            // Generate a short burst of white noise (Click)
            playClick: () => {
                if (!AudioEngine.ctx) AudioEngine.init();
                AudioEngine.resume();
                if (!AudioEngine.ctx) return;

                const t = AudioEngine.ctx.currentTime;
                const bufferSize = AudioEngine.ctx.sampleRate * 0.015; // 15ms burst
                const buffer = AudioEngine.ctx.createBuffer(1, bufferSize, AudioEngine.ctx.sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() * 2 - 1) * 0.8; 
                }

                const noise = AudioEngine.ctx.createBufferSource();
                noise.buffer = buffer;
                
                const filter = AudioEngine.ctx.createBiquadFilter();
                filter.type = 'highpass';
                filter.frequency.value = 1200;

                const gain = AudioEngine.ctx.createGain();
                gain.gain.setValueAtTime(0.3, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.01);

                noise.connect(filter);
                filter.connect(gain);
                gain.connect(AudioEngine.ctx.destination);
                
                noise.start(t);
            },
            playWin: () => {
                if (!AudioEngine.ctx) AudioEngine.init();
                AudioEngine.resume();
                if (!AudioEngine.ctx) return;

                const t = AudioEngine.ctx.currentTime;
                
                const osc = AudioEngine.ctx.createOscillator();
                const gain = AudioEngine.ctx.createGain();
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(880, t); // A5
                
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.2, t + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 1.5);
                
                osc.connect(gain);
                gain.connect(AudioEngine.ctx.destination);
                osc.start(t);
                osc.stop(t + 1.5);
            }
        };

        // --- ICONS ---
        const Icons = {
            Plus: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            BookOpen: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Settings: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Edit: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            Shuffle: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l14.2-12.7c.7-1 1.9-1.6 3.1-1.6"/><path d="M2 6h1.4c1.3 0 2.5.6 3.3 1.7l14.2 12.7c.7 1 1.9 1.6 3.1 1.6"/><path d="M19 13.5L24 18l-5 4.5"/><path d="M19 2L24 6.5l-5 4.5"/></svg>,
            History: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,
            X: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Layers: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>,
            Utensils: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
            IceCream: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m7 11 4.08 10.35a1 1 0 0 0 1.84 0L17 11"/><path d="M17 7A5 5 0 0 0 7 7"/><path d="M17 7a2 2 0 0 1 0 4H7a2 2 0 0 1 0-4"/></svg>,
            Coffee: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></svg>,
            Moon: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Beer: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 11h1a3 3 0 0 1 0 6h-1"/><path d="M9 12v6"/><path d="M13 12v6"/><path d="M14 7.5c-1 0-1.44.5-3 .5s-2-.5-3-.5-1.72.5-2.5.5a2.5 2.5 0 0 1 0-5c.78 0 1.57.5 2.5.5S9.44 2 11 2s2 1.5 3 1.5 1.72-.5 2.5-.5a2.5 2.5 0 0 1 0 5c-.78 0-1.57-.5-2.5-.5Z"/><path d="M5 8v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8"/></svg>,
            Flame: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.9-2 2-2h.5Z"/></svg>,
            Check: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>,
            ArrowUp: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 12 7-7 7 7"/><path d="M12 19V5"/></svg>,
            ArrowDown: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>,
            Trash2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Star: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            Search: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Edit2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Share2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>,
            Download: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            RefreshCw: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            Loader2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            SlidersHorizontal: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="21" x2="14" y1="4" y2="4"/><line x1="10" x2="3" y1="4" y2="4"/><line x1="21" x2="12" y1="12" y2="12"/><line x1="8" x2="3" y1="12" y2="12"/><line x1="21" x2="16" y1="20" y2="20"/><line x1="12" x2="3" y1="20" y2="20"/><line x1="14" x2="14" y1="2" y2="6"/><line x1="8" x2="8" y1="10" y2="14"/><line x1="16" x2="16" y1="18" y2="22"/></svg>,
            LayoutGrid: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            ToggleRight: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="12" x="2" y="6" rx="6" ry="6"/><circle cx="16" cy="12" r="2"/></svg>,
            ToggleLeft: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="12" x="2" y="6" rx="6" ry="6"/><circle cx="8" cy="12" r="2"/></svg>,
            UtensilsCrossed: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8"/><path d="M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7"/><path d="m2.1 21.8 6.4-6.3"/><path d="m19 5-7 7"/></svg>,
            MapPin: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Tag: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l5 5a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828l-5-5z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>,
            Save: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            Upload: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Maximize2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" x2="14" y1="3" y2="10"/><line x1="3" x2="10" y1="21" y2="14"/></svg>,
            Sun: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2"/><path d="M12 21v2"/><path d="M4.22 4.22l1.42 1.42"/><path d="M18.36 18.36l1.42 1.42"/><path d="M1 12h2"/><path d="M21 12h2"/><path d="M4.22 19.78l1.42-1.42"/><path d="M18.36 5.64l1.42-1.42"/></svg>,
            Volume2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>,
            VolumeX: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>,
            Ban: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m4.9 4.9 14.2 14.2"/></svg>,
            Copy: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
        };

        // --- 1. CONFIG & DATA ---
        // 2. ËøôÈáåÂ∑≤‰øÆÊîπ‰∏∫ÊÇ®Ë¶ÅÊ±ÇÁöÑÊú¨Âú∞ÂõæÁâáË∑ØÂæÑ
        const USER_CAT_IMAGE_SRC = './cat.png';
        const DEFAULT_CAT_IMAGE = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj4KICA8cGF0aCBkPSJNNDAsNzAgUTIwLDIwIDcwLDQwIFExMDAsMjAgMTMwLDQwIFExODAsMjAgMTYwLDcwIFExODAsMTAwIDE2MCwxNTAgUTEwMCwxODAgNDAsMTUwIFEyMCwxMDAgNDAsNzAgWiBNNjAsODAgQTUsNSAwIDAgMSA3MCw4MCBBNSw1IDAgMCAxIDYwLDgwIE0xMzAsODAgQTUsNSAwIDAgMSAxNDAsODAgQTUsNSAwIDAgMSAxMzAsODAgTTEwMCwxMTAgUTkwLDEyMCAxMTAsMTIwIiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iNSIvPgo8L3N2Zz4=";

        const ICON_MAP = {
            'Layers': <Icons.Layers className="w-3.5 h-3.5" />,
            'Utensils': <Icons.Utensils className="w-3.5 h-3.5" />,
            'IceCream': <Icons.IceCream className="w-3.5 h-3.5" />,
            'Coffee': <Icons.Coffee className="w-3.5 h-3.5" />,
            'Moon': <Icons.Moon className="w-3.5 h-3.5" />,
            'Beer': <Icons.Beer className="w-3.5 h-3.5" />,
            'Flame': <Icons.Flame className="w-3.5 h-3.5" />,
        };

        const GEO_OPTIONS = ['Â∑ùÊπò', 'Á≤§ÈóΩ', 'Ê±üÊµô', 'ÂåóÊñπ', 'Êó•Èü©', 'Ê¨ßÁæé', '‰∏úÂçó‰∫ö', 'ÈÄöÁî®'];
        const FLAVOR_OPTIONS = ['Ëæ£', 'Ê∏ÖÊ∑°', 'Áîú', 'ÈÖ∏', 'Âí∏È¶ô', 'Ê≤πÁÇ∏', 'ÁîüÂÜ∑', 'ÈáçÂè£'];
        const CATEGORY_LABELS = {
            fast_food: 'Âø´È§êÁÆÄÈ§ê', chinese: '‰∏≠ÂºèÊ≠£È§ê', japanese: 'Êó•ÂºèÊñôÁêÜ', korean: 'Èü©ÂºèÊñôÁêÜ',
            western: 'Ë•øÂºèÊ≠£È§ê', healthy: 'ËΩªÈ£üÊ≤ôÊãâ', dessert: 'ÁîúÁÇπÈ•ÆÂìÅ', noodle: 'Èù¢È£üÁ≤âÁ±ª', hotpot: 'ÁÅ´ÈîÖÂÜíËèú'
        };

        const DEFAULT_NAV_TABS = [
            { id: 'all', label: 'ÂÖ®ÈÉ®', iconName: 'Layers', filterTags: [] },
            { id: 'meal', label: 'Ê≠£È§ê', iconName: 'Utensils', filterTags: ['Ê≠£È§ê', 'Âø´È§ê', 'Èù¢È£ü', 'ÁÅ´ÈîÖËèú'] },
            { id: 'dessert', label: 'ÁîúÂìÅ', iconName: 'IceCream', filterTags: ['ÁîúÂìÅ', 'ËõãÁ≥ï', 'ÂÜ∞Ê∑áÊ∑ã'] },
            { id: 'drink', label: 'È•ÆÊñô', iconName: 'Coffee', filterTags: ['È•ÆÂìÅ', 'Â•∂Ëå∂', 'ÂíñÂï°', 'ÊûúËå∂'] },
            { id: 'night', label: 'ÂÆµÂ§ú', iconName: 'Moon', filterTags: ['ÂÆµÂ§ú', 'ÁÉßÁÉ§', 'ÂÜ∑‰∏≤', 'Âç§Âë≥'] },
        ];

        // EXPANDED FOOD DATABASE (Sanitized Descriptions)
        const FOOD_DATABASE = [
            // --- Âø´È§ê/ÁÆÄÈ§ê ---
            { id: '1', name: 'È∫¶ÂΩìÂä≥', icon: 'üçü', category: 'fast_food', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'Ê≤πÁÇ∏', 'Ê±âÂ†°'], description: 'ÂÖ®ÁêÉÁü•ÂêçËøûÈîÅÂø´È§êÔºåÊ±âÂ†°‰∏éËñØÊù°ÁöÑÁªèÂÖ∏ÁªÑÂêàÔºåÊñπ‰æøÂø´Êç∑„ÄÇ' },
            { id: '2', name: 'ËÇØÂæ∑Âü∫', icon: 'üçó', category: 'fast_food', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'Ê≤πÁÇ∏', 'È∏°ËÇâ'], description: 'ÁªèÂÖ∏ÁÇ∏È∏°Âø´È§êÔºåÂéüÂë≥È∏°Â§ñÁöÆÈÖ•ËÑÜÔºåËÇâË¥®È≤úÂ´©Â§öÊ±Å„ÄÇ' },
            { id: '20', name: 'Ê±âÂ†°Áéã', icon: 'üçî', category: 'fast_food', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'Ê≤πÁÇ∏', 'ÁâõËÇâ'], description: '‰∏ªÊâìÁÅ´ÁÉ§ÁâõËÇâÈ•ºÔºåÁöáÂ†°ÂàÜÈáèÂçÅË∂≥ÔºåËÇâÈ¶ôÊµìÈÉÅ„ÄÇ' },
            { id: '33', name: 'Â°îÊñØÊ±Ä', icon: 'ü•Ø', category: 'fast_food', tags: ['Âø´È§ê', 'ÈÄöÁî®', 'Âí∏È¶ô', '‰∏≠ÂºèÊ±âÂ†°'], description: 'ÁâπËâ≤Áé∞ÁÉ§Èù¢ÁöÆÔºåÂè£ÊÑüÁ≠ãÈÅìÔºåËûçÂêà‰∏≠ÂºèÈ£éÂë≥ÁöÑÊ±âÂ†°„ÄÇ' },
            { id: '34', name: 'Âæ∑ÂÖãÂ£´', icon: 'üçó', category: 'fast_food', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'Ê≤πÁÇ∏', 'ËÑÜÁöÆÈ∏°'], description: 'ËÑÜÁöÆÁÇ∏È∏°ÊòØ‰∏ÄÁªùÔºåÂ§ñÁöÆÈáëÈªÑÈÖ•ËÑÜÔºåÈ∏°ËÇâÈ≤úÂ´©ÂÖ•Âë≥„ÄÇ' },
            { id: '16', name: 'ËµõÁôæÂë≥', icon: 'ü•™', category: 'healthy', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'ÁîüÂÜ∑', '‰∏âÊòéÊ≤ª'], description: 'Êñ∞È≤úËî¨ËèúÊê≠ÈÖç‰ΩéËÑÇËÇâÁ±ªÔºåÈù¢ÂåÖÁé∞ÁÉ§ÔºåÊ∏ÖÁàΩÂÅ•Â∫∑ÁöÑÈÄâÊã©„ÄÇ' },
            { id: '4', name: 'Ê≤ôÂéøÂ∞èÂêÉ', icon: 'ü•ü', category: 'chinese', tags: ['Âø´È§ê', 'Á≤§ÈóΩ', 'Ê∏ÖÊ∑°', 'ÊâÅËÇâ'], description: 'ÁªèÊµéÂÆûÊÉ†ÁöÑÂõΩÊ∞ëÂ∞èÂêÉÔºåÊâÅËÇâÁöÆËñÑÈ¶ÖÈüßÔºåÊãåÈù¢È¶ôÊ∞îÊâëÈºª„ÄÇ' },
            { id: '13', name: 'ÈªÑÁÑñÈ∏°Á±≥È•≠', icon: 'üçõ', category: 'chinese', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Á±≥È•≠'], description: 'È∏°ËÇâÊªëÂ´©ÔºåÊ±§Ê±ÅÊµìÈÉÅÂí∏È¶ôÔºåÈùûÂ∏∏ÈÄÇÂêàÊê≠ÈÖçÁ±≥È•≠È£üÁî®„ÄÇ' },
            { id: '36', name: 'ÈöÜÊ±üÁå™ËÑöÈ•≠', icon: 'üç±', category: 'chinese', tags: ['Ê≠£È§ê', 'Á≤§ÈóΩ', 'Âí∏È¶ô', 'Á±≥È•≠'], description: 'Áå™ËÑöÂç§ÂæóËΩØÁ≥ØÂÖ•Âë≥ÔºåËÇ•ËÄå‰∏çËÖªÔºåÊê≠ÈÖçÈÖ∏ËèúËß£ËÖªÂºÄËÉÉ„ÄÇ' },
            { id: '40', name: 'Êú®Ê°∂È•≠', icon: 'ü™µ', category: 'chinese', tags: ['Âø´È§ê', 'Â∑ùÊπò', 'Ëæ£', 'Á±≥È•≠'], description: 'Áé∞ÁÇíÁé∞ÂçñÔºåËèúÂìÅ‰∏∞ÂØåÂ§öÊ†∑ÔºåÂ∏¶ÊúâÁã¨ÁâπÁöÑÊú®Ê°∂Ê∏ÖÈ¶ô„ÄÇ' },
            { id: '41', name: 'ÁõñÊµáÈ•≠', icon: 'üçõ', category: 'chinese', tags: ['Âø´È§ê', 'ÈÄöÁî®', 'Âí∏È¶ô', 'Á±≥È•≠'], description: 'ËèúÈ•≠Âêà‰∏ÄÔºåÊñπ‰æøÂø´Êç∑ÔºåÂè£Âë≥ÈÄâÊã©Â§öÊ†∑ÔºåËß£ÂÜ≥Â∑•‰ΩúÈ§êÈöæÈ¢ò„ÄÇ' },
            { id: '80', name: 'ÂÖ∞Â∑ûÁâõËÇâÈù¢', icon: 'üçú', category: 'noodle', tags: ['Âø´È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Ê∏ÖÁúü'], description: 'Ê±§Ê∏ÖÈù¢Á≠ãÔºåËêùÂçúÁôΩÂáÄÔºåËæ£Ê≤πÁ∫¢‰∫ÆÔºåÈ¶ôËèúÁø†ÁªøÔºå‰∏ÄÁ¢óÂÖ•È≠Ç„ÄÇ' },
            { id: '81', name: 'ÁúüÂäüÂ§´', icon: 'üç≤', category: 'fast_food', tags: ['Âø´È§ê', 'Á≤§ÈóΩ', 'Ê∏ÖÊ∑°', 'Ëí∏Ëèú'], description: '‰∏ªÊâìËí∏ÂìÅÔºå‰øùÁïôÈ£üÊùêÂéüÂë≥ÂíåËê•ÂÖªÔºåÊ∏ÖÊ∑°‰∏çÊ≤πËÖª„ÄÇ' },
            { id: '82', name: 'ÂêâÈáéÂÆ∂', icon: 'üçö', category: 'fast_food', tags: ['Âø´È§ê', 'Êó•Èü©', 'Âí∏È¶ô', 'ÁâõËÇâÈ•≠'], description: 'ÊãõÁâåÁâõËÇâÈ•≠ÔºåËÇ•ÁâõÁâáËñÑÂÖ•Âë≥ÔºåÊ¥ãËë±ÁîòÁîúÔºåÊ±§Ê±ÅÊãåÈ•≠‰∏ÄÁªù„ÄÇ' },
            { id: '83', name: 'ËÄÅ‰π°È∏°', icon: 'üêî', category: 'chinese', tags: ['Âø´È§ê', 'Ê±üÊµô', 'Âí∏È¶ô', 'È∏°Ê±§'], description: '‰ª•ËÇ•Ë•øËÄÅÊØçÈ∏°Ê±§‰∏∫ÁâπËâ≤ÔºåËèúÂìÅÂÆ∂Â∏∏ÔºåÂè£Âë≥Ê∏ÖÈ≤ú„ÄÇ' },

            // --- Ê≠£È§ê (‰∏≠Âºè/Ë•øÂºè/Êó•Èü©) ---
            { id: '3', name: 'ÂøÖËÉúÂÆ¢', icon: 'üçï', category: 'western', tags: ['Ê≠£È§ê', 'Ê¨ßÁæé', 'Âí∏È¶ô', 'Êä´Ëê®'], description: 'ÁªèÂÖ∏ÈìÅÁõòÊä´Ëê®ÔºåËäùÂ£´ÊµìÈÉÅÊãâ‰∏ùÔºåÈÄÇÂêàÂ§ö‰∫∫ËÅöÈ§êÂàÜ‰∫´„ÄÇ' },
            { id: '6', name: 'ÈáçÂ∫ÜÁÅ´ÈîÖ', icon: 'üî•', category: 'hotpot', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Ëæ£', 'ËÅöÈ§ê'], description: 'Á∫¢Ê≤πÊ±§Â∫ïÈÜáÂéöÈ¶ôËæ£ÔºåÊØõËÇöÈ∏≠ËÇ†Âè£ÊÑüÁàΩËÑÜÔºåËÅöÈ§êÊ∞õÂõ¥ÊµìÂéö„ÄÇ' },
            { id: '47', name: 'Êµ∑Â∫ïÊçû', icon: 'ü•ò', category: 'hotpot', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Âí∏È¶ô', 'ÊúçÂä°'], description: 'ÊúçÂä°Âë®Âà∞ÁÉ≠ÊÉÖÔºåÁï™ËåÑÊ±§Â∫ïÊµìÈÉÅÂ•ΩÂñùÔºåËèúÂìÅÊñ∞È≤úÂ§öÊ†∑„ÄÇ' },
            { id: '48', name: 'Âë∑Âì∫Âë∑Âì∫', icon: 'üç≤', category: 'hotpot', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', '‰∏Ä‰∫∫È£ü'], description: 'ÂêßÂè∞ÂºèÂ∞èÁÅ´ÈîÖÔºåÁßòÂà∂È∫ªÈÖ±Ëò∏ÊñôÈ£éÂë≥Áã¨ÁâπÔºå‰∏Ä‰∫∫È£ü‰πüÁ≤æÂΩ©„ÄÇ' },
            { id: '43', name: 'ÊΩÆÊ±ïÁâõËÇâÁÅ´ÈîÖ', icon: 'üêÇ', category: 'hotpot', tags: ['Ê≠£È§ê', 'Á≤§ÈóΩ', 'Ê∏ÖÊ∑°', 'ÁâõËÇâ'], description: 'ËÆ≤Á©∂ÁâõËÇâÈ≤úÂàáÔºåÈÉ®‰ΩçÁªÜÂàÜÔºåÊ±§Â∫ïÊ∏ÖÊ∑°ÔºåÁ™ÅÂá∫ÁâõËÇâÊú¨Âë≥„ÄÇ' },
            { id: '22', name: 'ÈÖ∏ËèúÈ±º', icon: 'üêü', category: 'chinese', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Ëæ£', 'ÈÖ∏', 'È±º'], description: 'È±ºËÇâÈ≤úÂ´©ÊªëÁàΩÔºåÈÖ∏ËèúÈÖ∏ÁàΩÂºÄËÉÉÔºåÊ±§Â∫ïÈáëÈªÑËØ±‰∫∫„ÄÇ' },
            { id: '24', name: 'Â§™‰∫åÈÖ∏ËèúÈ±º', icon: 'üêü', category: 'chinese', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Ëæ£', 'ÈÖ∏'], description: '‰∏ªÊâìËÄÅÂùõÂ≠êÈÖ∏ËèúÈ±ºÔºåÈÖ∏ËèúÂè£ÊÑüËÑÜÁàΩÔºåÈ±ºËÇâÊó†Âà∫È≤úÂ´©„ÄÇ' },
            { id: '71', name: 'Â∞èÈæôËôæ', icon: 'ü¶û', category: 'chinese', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Ëæ£', 'ÂÆµÂ§ú'], description: 'Âè£Âë≥Â§öÊ†∑ÔºåÈ∫ªËæ£È≤úÈ¶ôÔºåËÇâË¥®QÂºπÔºåÂ§úÂÆµËÅöÈ§êÁöÑÁÉ≠Èó®ÈÄâÊã©„ÄÇ' },
            { id: '301', name: 'Á∫¢ÁÉßËÇâ', icon: 'ü•©', category: 'chinese', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Âí∏È¶ô', 'ËÇâÈ£ü'], description: '‰∫îËä±ËÇâËÇ•Áò¶Áõ∏Èó¥ÔºåËâ≤Ê≥ΩÁ∫¢‰∫ÆÔºåÂè£ÊÑüËΩØÁ≥ØÔºåÂí∏ÁîúÈÄÇÂè£„ÄÇ' },
            { id: '302', name: 'Ê∞¥È•∫', icon: 'ü•ü', category: 'chinese', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Èù¢È£ü'], description: 'ÁöÆËñÑÈ¶ÖÂ§ßÔºåÊ±ÅÊ∞¥‰∏∞ÂØåÔºåÈ¶ÖÊñôÈÄâÊã©Â§öÊ†∑Ôºå‰º†ÁªüÈù¢È£ü‰ª£Ë°®„ÄÇ' },
            { id: '305', name: 'ÁÉ§È∏≠', icon: 'ü¶Ü', category: 'chinese', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'ËÅöÈ§ê'], description: 'È∏≠ÁöÆÈÖ•ËÑÜÔºåÈ∏≠ËÇâÁªÜÂ´©ÔºåÊê≠ÈÖçËç∑Âè∂È•ºÂíåÁîúÈù¢ÈÖ±ÔºåÈ£éÂë≥Áã¨Áâπ„ÄÇ' },
            { id: '17', name: 'Êó•ÂºèÊãâÈù¢', icon: 'üç•', category: 'japanese', tags: ['Ê≠£È§ê', 'Êó•Èü©', 'Âí∏È¶ô', 'Ê±§Èù¢'], description: 'Ë±öÈ™®Ê±§Â∫ïÈïøÊó∂Èó¥ÁÜ¨Âà∂ÔºåÊµìÈÉÅÈÜáÂéöÔºåÈù¢Êù°Âä≤ÈÅìÔºåÈÖçÊñô‰∏∞ÂØå„ÄÇ' },
            { id: '9', name: 'ÂØøÂè∏', icon: 'üç£', category: 'japanese', tags: ['Ê≠£È§ê', 'Êó•Èü©', 'ÁîüÂÜ∑', 'Êµ∑È≤ú'], description: 'Á±≥È•≠ÈÖ∏ÁîúÈÄÇÂ∫¶ÔºåÈ±ºÁîüÊñ∞È≤úËÇ•ÁæéÔºåÈÄ†ÂûãÁ≤æËá¥ÔºåÂè£ÊÑü‰∏∞ÂØå„ÄÇ' },
            { id: '18', name: 'Áü≥ÈîÖÊãåÈ•≠', icon: 'üç≥', category: 'korean', tags: ['Ê≠£È§ê', 'Êó•Èü©', 'Ëæ£', 'Á±≥È•≠'], description: 'ÁÉ≠Áü≥ÈîÖÊøÄÂèëÂá∫Á±≥È•≠ÁÑ¶È¶ôÔºåÈÖçËèú‰∏∞ÂØåÔºåÊãåÂÖ•Ëæ£ÈÖ±È£éÂë≥ÂçÅË∂≥„ÄÇ' },
            { id: '10', name: 'Èü©ÂºèÁÇ∏È∏°', icon: 'üçó', category: 'korean', tags: ['Âø´È§ê', 'Êó•Èü©', 'Áîú', 'Ëæ£', 'Ê≤πÁÇ∏'], description: 'ÁÇ∏È∏°Â§ñÂ£≥ÈÖ•ËÑÜÔºåË£πÊª°ÁîúËæ£ÈÖ±Ê±ÅÔºåËÇâË¥®È≤úÂ´©ÔºåÈ£éÂë≥Áã¨Áâπ„ÄÇ' },
            { id: '49', name: 'ÁâõÊéí', icon: 'ü•©', category: 'western', tags: ['Ê≠£È§ê', 'Ê¨ßÁæé', 'Âí∏È¶ô', 'ËÇâÈ£ü'], description: 'Á≤æÈÄâ‰ºòË¥®ÁâõËÇâÔºåÁÖéÁÉ§Ëá≥ÈÄÇÂÆúÁÜüÂ∫¶ÔºåËÇâË¥®È≤úÂ´©Â§öÊ±Å„ÄÇ' },
            { id: '84', name: 'Ë•øË¥ùËéúÈù¢Êùë', icon: 'üçú', category: 'chinese', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Èù¢È£ü'], description: '‰∏ªÊâìË•øÂåóÈ£éÂë≥ÔºåËéúÈù¢Á≠ãÈÅìÔºåÁæäËÇâÈ≤úÁæéÔºåÈ£üÊùêÂ§©ÁÑ∂ÂÅ•Â∫∑„ÄÇ' },
            { id: '85', name: 'Â§ñÂ©ÜÂÆ∂', icon: 'üëµ', category: 'chinese', tags: ['Ê≠£È§ê', 'Ê±üÊµô', 'Âí∏È¶ô', 'Êù≠Â∏ÆËèú'], description: 'Êù≠Â∏ÆÂÆ∂Â∏∏ËèúÔºåÂè£Âë≥ÈÄÇ‰∏≠ÔºåÁéØÂ¢ÉÊ∏©È¶®ÔºåÊÄß‰ª∑ÊØîÈ´ò„ÄÇ' },
            { id: '86', name: 'ÁªøËå∂È§êÂéÖ', icon: 'üçµ', category: 'chinese', tags: ['Ê≠£È§ê', 'Ê±üÊµô', 'Âí∏È¶ô', 'Êù≠Â∏ÆËèú'], description: 'ËûçÂêàËèúÁ≥ªÔºåËèúÂìÅÁ≤æËá¥ÔºåÁéØÂ¢É‰ºòÈõÖÔºåÈÄÇÂêà‰ºëÈó≤ËÅöÈ§ê„ÄÇ' },

            // --- ÂÆµÂ§ú/Â∞èÂêÉ ---
            { id: '12', name: 'ÁÉßÁÉ§/ÁÉ§‰∏≤', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÂåóÊñπ', 'Âí∏È¶ô', 'ÂÆµÂ§ú'], description: 'ÁÇ≠ÁÅ´ÁÉ§Âà∂ÔºåÂ≠úÁÑ∂Ëæ£Ê§íÂ¢ûÈ¶ôÔºåËÇâ‰∏≤Â§ñÁÑ¶ÈáåÂ´©ÔºåÂ§úÂÆµÈ¶ñÈÄâ„ÄÇ' },
            { id: '67', name: 'ÁªùÂë≥È∏≠ËÑñ', icon: 'ü¶Ü', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Ëæ£', 'ÂÆµÂ§ú', 'Âç§Âë≥'], description: 'Âç§Âë≥È¶ôËæ£ÊµìÈÉÅÔºåË∂äÂöºË∂äÈ¶ôÔºåÈÄÇÂêà‰ºëÈó≤Ëß£È¶ã„ÄÇ' },
            { id: '68', name: 'Âë®ÈªëÈ∏≠', icon: 'ü¶Ü', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Áîú', 'Ëæ£', 'ÂÆµÂ§ú', 'Âç§Âë≥'], description: 'ÂÖ•Âè£ÂæÆÁîúÔºåÂõûÂë≥È∫ªËæ£ÔºåËÇâË¥®Á¥ßÂÆûÔºåÈ£éÂë≥Áã¨Áâπ„ÄÇ' },
            { id: '201', name: 'ÂÖ≥‰∏úÁÖÆ', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'Êó•Èü©', 'Ê∏ÖÊ∑°', 'ÂÆµÂ§ú'], description: 'Ê±§Â∫ïÊ∏ÖÈ≤úÔºåÈ£üÊùêÂê∏Êª°Ê±§Ê±ÅÔºåÂè£ÊÑüËΩØÁ≥ØÔºåÊ∏©ÊöñÊ≤ªÊÑà„ÄÇ' },
            { id: '202', name: 'Ê≠£Êñ∞È∏°Êéí', icon: 'üçó', category: 'fast_food', tags: ['Â∞èÂêÉ', 'ÈÄöÁî®', 'Ê≤πÁÇ∏', 'ÂÆµÂ§ú'], description: 'È∏°ÊéíÁÇ∏Ëá≥ÈáëÈªÑÔºåÂ§ñÈÖ•ÈáåÂ´©ÔºåÊíí‰∏äË∞ÉÊñôÈ¶ôÊ∞îÂõõÊ∫¢„ÄÇ' },
            { id: '203', name: 'ÈìÅÊùøÈ±øÈ±º', icon: 'ü¶ë', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÈÄöÁî®', 'Ëæ£', 'ÂÆµÂ§ú'], description: 'È±øÈ±ºÂú®ÈìÅÊùø‰∏äÊªãÊªã‰ΩúÂìçÔºåÊ¥ãËë±Â¢ûÈ¶ôÔºåÂè£ÊÑüÂºπÁâô„ÄÇ' },
            { id: '205', name: 'Ëá≠Ë±ÜËÖê', icon: '‚¨õ', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Ëæ£', 'Ëá≠', 'ÂÆµÂ§ú'], description: 'ÈóªÁùÄËá≠ÂêÉÁùÄÈ¶ôÔºåÂ§ñÁöÆÈÖ•ËÑÜÔºåÂÜÖÈáåËΩØÂ´©ÔºåÊ±§Ê±ÅÈ≤úËæ£„ÄÇ' },
            { id: '206', name: 'ÁÉ§ÁîüËöù', icon: 'ü¶™', category: 'chinese', tags: ['Â∞èÂêÉ', 'Á≤§ÈóΩ', 'Âí∏È¶ô', 'Êµ∑È≤ú', 'ÂÆµÂ§ú'], description: 'ÁîüËöùËÇ•ÁæéÂ§öÊ±ÅÔºåÊê≠ÈÖçËíúËìâÁ≤â‰∏ùÔºåÈ≤úÂë≥ÂçÅË∂≥„ÄÇ' },
            { id: '207', name: 'ÈíµÈíµÈ∏°', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Ëæ£', 'ÂÜ∑‰∏≤'], description: 'È£üÊùêÊµ∏Ê≥°Âú®Á∫¢Ê≤πÊ±§Ê±Å‰∏≠ÔºåÈ∫ªËæ£È≤úÈ¶ôÔºåÊãøÂèñÊñπ‰æø„ÄÇ' },
            { id: '208', name: 'Ê≥°Èù¢', icon: 'üçú', category: 'fast_food', tags: ['Âø´È§ê', 'ÈÄöÁî®', 'Âí∏È¶ô', 'ÂÆµÂ§ú'], description: 'Èù¢Êù°QÂºπÔºåÊ±§Â§¥ÊµìÈÉÅÔºåÁÆÄÂçïÂø´Êç∑ÔºåÊ∑±Â§úÊÖ∞Ëóâ„ÄÇ' },
            { id: '42', name: 'ÁÖéÈ•ºÊûúÂ≠ê', icon: 'üåØ', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Êó©È§ê'], description: 'ÊùÇÁ≤ÆÈ•ºÁöÆÊëäÈ∏°ËõãÔºåÂà∑ÈÖ±Âä†ËñÑËÑÜÔºåÂè£ÊÑüÂ±ÇÊ¨°‰∏∞ÂØå„ÄÇ' },
            { id: '39', name: 'ÂáâÁöÆ', icon: 'ü•¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÂåóÊñπ', 'Ëæ£', 'ÈÖ∏'], description: 'ÂáâÁöÆÈÄè‰∫ÆÂä≤ÈÅìÔºåÊê≠ÈÖçÈªÑÁìú‰∏ùÈù¢Á≠ãÔºåÈÖ∏Ëæ£ÁàΩÂè£„ÄÇ' },
            { id: '87', name: 'ÁÖå‰∏äÁÖå', icon: 'ü¶Ü', category: 'chinese', tags: ['Â∞èÂêÉ', 'Ê±üÊµô', 'Âí∏È¶ô', 'Âç§Âë≥'], description: 'ÈÖ±Âç§È£éÂë≥ÔºåÂí∏ÁîúÈÄÇ‰∏≠ÔºåËÇâË¥®Âπ≤È¶ôÔºåÂõûÂë≥ÊÇ†Èïø„ÄÇ' },
            { id: '88', name: 'Â§∏Áà∂ÁÇ∏‰∏≤', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Ëæ£', 'Ê≤πÁÇ∏', 'ÂÆµÂ§ú'], description: '‰πêÂ±±Ê≤πÁÇ∏‰∏≤‰∏≤ÔºåÈ£üÊùê‰∏∞ÂØåÔºåÂà∑‰∏äÁßòÂà∂ÈÖ±ÊñôÔºåÈ¶ôËÑÜÂèØÂè£„ÄÇ' },
            { id: '89', name: 'ÂñúÂßêÁÇ∏‰∏≤', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÈÄöÁî®', 'Ê≤πÁÇ∏', 'ÂÆµÂ§ú'], description: 'ÁÇ∏‰∏≤ÂìÅÁ±ªÂ§öÊ†∑ÔºåÂ§ñÁöÆÈÖ•ËÑÜ‰∏çÊ≤πËÖªÔºåÈÄÇÂêàËæπËµ∞ËæπÂêÉ„ÄÇ' },

            // --- È•ÆÂìÅ (ÂÖ∑‰ΩìÂìÅÁâå) ---
            { id: '26', name: 'ÁëûÂπ∏ÂíñÂï°', icon: 'ü¶å', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Ëã¶', 'ÂíñÂï°'], description: 'È´òÊÄß‰ª∑ÊØîÂíñÂï°ËøûÈîÅÔºåÁîüÊ§∞ÊãøÈìÅÂè£ÊÑüÈ°∫ÊªëÔºåÂπøÂèóÊ¨¢Ëøé„ÄÇ' },
            { id: '15', name: 'ÊòüÂ∑¥ÂÖã', icon: '‚òï', category: 'dessert', tags: ['È•ÆÂìÅ', 'Ê¨ßÁæé', 'Ëã¶', 'ÂíñÂï°'], description: 'ÂÖ®ÁêÉÁü•ÂêçÂíñÂï°ÂìÅÁâåÔºåÁéØÂ¢ÉËàíÈÄÇÔºåÂíñÂï°È•ÆÂìÅÈÄâÊã©‰∏∞ÂØå„ÄÇ' },
            { id: '25', name: 'ÂñúËå∂', icon: 'ü•§', category: 'dessert', tags: ['È•ÆÂìÅ', 'Á≤§ÈóΩ', 'Áîú', 'Â•∂Ëå∂'], description: 'Êñ∞Ëå∂È•Æ‰ª£Ë°®Ôºå‰ΩøÁî®ÁúüÂ•∂ÁúüÊûúÔºåËäùÂ£´ËåóËå∂Âè£ÊÑüÁªÜËÖª„ÄÇ' },
            { id: '28', name: 'Â•àÈõ™ÁöÑËå∂', icon: 'üçµ', category: 'dessert', tags: ['È•ÆÂìÅ', 'Á≤§ÈóΩ', 'Áîú', 'ÊûúËå∂'], description: 'Èú∏Ê∞îÈ≤úÊûúËå∂ÔºåÊê≠ÈÖçËΩØÊ¨ßÂåÖÔºåÁ≤æËá¥‰∏ãÂçàËå∂„ÄÇ' },
            { id: '31', name: 'Èú∏ÁéãËå∂Âß¨', icon: 'üëò', category: 'dessert', tags: ['È•ÆÂìÅ', 'Â∑ùÊπò', 'Áîú', 'Â•∂Ëå∂'], description: 'Êñ∞‰∏≠ÂºèÂõΩÈ£éËå∂È•ÆÔºåÂéüÂè∂È≤úÂ•∂Ëå∂ÔºåËå∂È¶ôÊµìÈÉÅ‰∏çËÖª„ÄÇ' },
            { id: '54', name: 'Ëå∂ÁôæÈÅì', icon: 'üêº', category: 'dessert', tags: ['È•ÆÂìÅ', 'Â∑ùÊπò', 'Áîú', 'Â•∂Ëå∂'], description: 'È•ÆÂìÅÂè£Âë≥Áã¨ÁâπÔºåÁî®ÊñôÊâéÂÆûÔºåË±Ü‰π≥ÁéâÈ∫íÈ∫üÈ£éÂë≥ÊµìÈÉÅ„ÄÇ' },
            { id: '53', name: 'Âè§Ëåó', icon: 'üç∂', category: 'dessert', tags: ['È•ÆÂìÅ', 'Ê±üÊµô', 'Áîú', 'ÊûúËå∂'], description: 'Ê∞¥ÊûúËå∂Êñ∞È≤úÂ•ΩÂñùÔºåËäùÂ£´Â•∂ÁõñÈÜáÂéöÔºåÊÄß‰ª∑ÊØî‰πãÈÄâ„ÄÇ' },
            { id: '27', name: 'ËúúÈõ™ÂÜ∞Âüé', icon: '‚õÑ', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'ÂÜ∞Ê∑áÊ∑ã'], description: '‰ª∑Ê†º‰∫≤Ê∞ëÔºåÂÜ∞Ê∑áÊ∑ãÂíåÊü†Ê™¨Ê∞¥ÊòØÊãõÁâåÔºåÈó®Â∫óÈÅçÂ∏É„ÄÇ' },
            { id: '30', name: 'CoCoÈÉΩÂèØ', icon: 'üßã', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'ËÄÅÁâåÂ•∂Ëå∂ËøûÈîÅÔºåÂ•∂Ëå∂‰∏âÂÖÑÂºüÈÖçÊñô‰∏∞ÂØåÔºåÂè£ÊÑüÁªèÂÖ∏„ÄÇ' },
            { id: '52', name: '1ÁÇπÁÇπ', icon: 'üü¢', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'Âè∞ÂºèÂ•∂Ëå∂‰ª£Ë°®ÔºåÂèØÂÖçË¥πÊ∑ªÂä†ÈÖçÊñôÔºåÂÆöÂà∂ÂåñÁ®ãÂ∫¶È´ò„ÄÇ' },
            { id: '55', name: 'Ê≤™‰∏äÈòøÂß®', icon: 'üë©', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: '‰∏ªÊâìÁé∞ÁÖÆ‰∫îË∞∑Ëå∂È•ÆÔºåË°ÄÁ≥ØÁ±≥Â•∂Ëå∂È¶ôÁîúËΩØÁ≥ØÔºåÂÅ•Â∫∑ÂÖªÁîü„ÄÇ' },
            { id: '56', name: '‰π¶‰∫¶ÁÉß‰ªôËçâ', icon: 'ü•£', category: 'dessert', tags: ['È•ÆÂìÅ', 'Â∑ùÊπò', 'Áîú', 'Âä†Êñô'], description: 'ÁÉß‰ªôËçâÂ•∂Ëå∂ÈÖçÊñô‰∏∞ÂØåÔºåÂçäÊùØÈÉΩÊòØÊñôÔºåÂè£ÊÑüÂ±ÇÊ¨°ÂàÜÊòé„ÄÇ' },
            { id: '57', name: 'ÁõäÁ¶æÂ†Ç', icon: 'ü•õ', category: 'dessert', tags: ['È•ÆÂìÅ', 'Á≤§ÈóΩ', 'Áîú', '‰æøÂÆú'], description: 'ÁõäÁ¶æÁÉ§Â•∂ÔºåÁÑ¶È¶ôÊµìÈÉÅÔºå‰æøÂÆúÂ§ßÊùØÔºåÂ≠¶ÁîüÂÖöÊúÄÁà±„ÄÇ' },
            { id: '63', name: 'Ëå∂È¢úÊÇ¶Ëâ≤', icon: 'üéè', category: 'dessert', tags: ['È•ÆÂìÅ', 'Â∑ùÊπò', 'Áîú', 'Â•∂Ëå∂'], description: 'ÈïøÊ≤ôÁâπËâ≤Â•∂Ëå∂ÔºåÂ•∂Ê≤πÈ°∂ÈÖçÁ¢ßÊ†πÊûúÔºåËå∂Â∫ïÊ∏ÖÁàΩÔºåÂõΩÈ£éÂåÖË£Ö„ÄÇ' },
            { id: '90', name: 'Manner', icon: '‚òï', category: 'dessert', tags: ['È•ÆÂìÅ', 'Ê¨ßÁæé', 'Ëã¶', 'ÂíñÂï°'], description: 'ÂõΩ‰∫ßÁ≤æÂìÅÂíñÂï°ÔºåÈó®Â∫óÂ∞èÂ∑ßÁ≤æËá¥ÔºåÂíñÂï°ÂìÅË¥®‰ºòËâØ„ÄÇ' },
            { id: '91', name: 'Tims', icon: 'üçÅ', category: 'dessert', tags: ['È•ÆÂìÅ', 'Ê¨ßÁæé', 'Ëã¶', 'ÂíñÂï°'], description: 'Ë¥ùÊûúÈÖçÂíñÂï°ÔºåÂä†ÊãøÂ§ßÂõΩÊ∞ëÂìÅÁâå„ÄÇ' },
            { id: '92', name: 'Ë¥°Ëå∂', icon: 'üçµ', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'Â•∂ÁõñËå∂ÁöÑÂÖàÈ©±ÔºåÂí∏È¶ôÂ•∂ÁõñÊê≠ÈÖçÊ∏ÖËå∂ÔºåÈ£éÂë≥Áã¨Áâπ„ÄÇ' },
            { id: '93', name: 'ÊûóÈáå', icon: 'üçã', category: 'dessert', tags: ['È•ÆÂìÅ', 'Á≤§ÈóΩ', 'ÈÖ∏', 'ÊûúËå∂'], description: 'ÊâãÊâìÊü†Ê™¨Ëå∂ÔºåÈ¶ôÊ∞îÊµìÈÉÅÔºåÂè£ÊÑüÈÖ∏ÁàΩËß£ËÖª„ÄÇ' },
            { id: '94', name: 'KOI', icon: 'üßã', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'ÈªÑÈáëÁèçÂ•∂ÔºåÁèçÁè†QÂºπÈáëÈªÑÔºåÂè£ÊÑüÊûÅ‰Ω≥„ÄÇ' },
            { id: '95', name: 'ÈπøËßíÂ∑∑', icon: 'ü¶å', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'ÈªëÁ≥ñÈπø‰∏∏È≤úÂ•∂ÔºåÊåÇÂ£ÅÁ∫πË∑ØÂ•ΩÁúãÂèàÂ•ΩÂñù„ÄÇ' },

            // --- ÁîúÂìÅ ---
            { id: '29', name: 'DQÂÜ∞Ê∑áÊ∑ã', icon: 'üç¶', category: 'dessert', tags: ['ÁîúÂìÅ', 'Ê¨ßÁæé', 'Áîú', 'ÂÜ∞Ê∑áÊ∑ã'], description: 'ÁæéÂºèÂÜ∞Ê∑áÊ∑ãÔºåÊö¥È£éÈõ™Á≥ªÂàóÂÄíÊùØ‰∏çÊ¥íÔºåÂ•∂È¶ôÊµìÈÉÅ„ÄÇ' },
            { id: '60', name: 'È≤úËäã‰ªô', icon: 'üçß', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Âè∞Âºè'], description: 'Âè∞ÂºèÁîúÂìÅÔºåËäãÂúÜËΩØÁ≥ØQÂºπÔºå‰ªôËçâÊ∏ÖÁÉ≠Ëß£ÊöëÔºå‰ªΩÈáèË∂≥„ÄÇ' },
            { id: '32', name: 'Êª°ËÆ∞ÁîúÂìÅ', icon: 'üçÆ', category: 'dessert', tags: ['ÁîúÂìÅ', 'Á≤§ÈóΩ', 'Áîú', 'Ê∏ØÂºè'], description: 'Ê∏ØÂºèÁîúÂìÅËøûÈîÅÔºåËäíÊûúÁè≠ÊàüÂíåÂèåÁöÆÂ•∂ÊòØÁªèÂÖ∏‰πãÈÄâ„ÄÇ' },
            { id: '96', name: 'ÂìàÊ†πËææÊñØ', icon: 'üç®', category: 'dessert', tags: ['ÁîúÂìÅ', 'Ê¨ßÁæé', 'Áîú', 'ÂÜ∞Ê∑áÊ∑ã'], description: 'È´òÁ´ØÂÜ∞Ê∑áÊ∑ãÂìÅÁâåÔºåÂè£ÊÑüÁ∫ØÊ≠£ÔºåË¥®Âú∞ÁªÜËÖªÊµìÈÉÅ„ÄÇ' },
            { id: '97', name: 'Â•ΩÂà©Êù•', icon: 'üç∞', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÂåóÊñπ', 'Áîú', 'ÁÉòÁÑô'], description: 'Áü•ÂêçÁÉòÁÑôÂìÅÁâåÔºåÂçäÁÜüËäùÂ£´Âè£ÊÑüËΩªÁõàÔºåÂÖ•Âè£Âç≥Âåñ„ÄÇ' },
            { id: '98', name: 'ËÆ∏ÁïôÂ±±', icon: 'ü•≠', category: 'dessert', tags: ['ÁîúÂìÅ', 'Á≤§ÈóΩ', 'Áîú', 'ËäíÊûú'], description: '‰∏ìÊ≥®‰∫éËäíÊûúÁîúÂìÅÔºåÂ§öËäíÂ∞è‰∏∏Â≠êÊ∏ÖÁîúÁàΩÂè£ÔºåËäíÊûúÈ¶ôÊµì„ÄÇ' },
            { id: '99', name: 'È≤çÂ∏àÂÇÖ', icon: 'ü•Ø', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÈÄöÁî®', 'Áîú', 'ÁÉòÁÑô'], description: 'ÁΩëÁ∫¢Á≥ïÁÇπÔºåËÇâÊùæÂ∞èË¥ùÂ§ñÈÖ•ÈáåÂ´©ÔºåÊµ∑ËãîÂë≥È¶ôËÑÜ„ÄÇ' },
            { id: '100', name: 'Áà∏Áà∏Á≥ñ', icon: 'üçû', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÈÄöÁî®', 'Áîú', 'ÁÉòÁÑô'], description: 'ÊâãÂ∑•ÂêêÂè∏‰∏ìÂçñÔºåÂ•∂È¶ôÊµìÈÉÅÔºåÂè£ÊÑüÊùæËΩØÊãâ‰∏ù„ÄÇ' },
            { id: '101', name: 'Ë•øÊ†ëÊ≥°Ëäô', icon: 'ü•Ø', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÈÄöÁî®', 'Áîú', 'ÁÉòÁÑô'], description: 'Áé∞ÁÉ§Ê≥°ËäôÔºåÂ§ñÁöÆÈÖ•ËÑÜÔºåÂÜÖÈ¶ÖÁªÜËÖªÁàÜÊµÜ„ÄÇ' },
            { id: '102', name: 'Lady M', icon: 'üç∞', category: 'dessert', tags: ['ÁîúÂìÅ', 'Ê¨ßÁæé', 'Áîú', 'ËõãÁ≥ï'], description: 'Á≤æÂìÅËõãÁ≥ïÂ∫óÔºåÂçÉÂ±ÇËõãÁ≥ïÂ±ÇÂ±ÇÂàÜÊòéÔºåÂè£ÊÑüÁªÜËÖª‰ºòÈõÖ„ÄÇ' },
        ];

        // --- 2. UTILS ---
        const getRandomBatch = (count, preferences, currentTab, sourceData) => {
            let filteredPool = sourceData.filter(item => {
                if (!currentTab.filterTags || currentTab.filterTags.length === 0) return true;
                return currentTab.filterTags.some(tag => item.tags.includes(tag));
            });

            // Session Ban Logic (Filtered at selection time)
            if (preferences.sessionBannedIds && preferences.sessionBannedIds.length > 0) {
                filteredPool = filteredPool.filter(item => !preferences.sessionBannedIds.includes(item.id));
            }

            let pool = filteredPool.filter((item) => {
                if (preferences.excludedCategories.includes(item.category)) return false;
                if (item.tags.some(tag => preferences.excludedTags.includes(tag))) return false;
                return true;
            });

            if (pool.length === 0 && filteredPool.length > 0) pool = filteredPool;

            const weightedPool = [...pool];
            const favoriteIds = preferences.favoriteItemIds || [];
            const ignoredFavoriteIds = preferences.ignoredFavoriteIds || [];
            const shouldPrioritizeFavorites = preferences.prioritizeFavorites !== false;

            pool.forEach(item => {
                if (shouldPrioritizeFavorites && favoriteIds.includes(item.id) && !ignoredFavoriteIds.includes(item.id)) {
                    for (let i = 0; i < 5; i++) weightedPool.push(item);
                }
            });

            const shuffled = weightedPool.sort(() => 0.5 - Math.random());
            const selected = [];
            const selectedIds = new Set();
            for (const item of shuffled) {
                if (!selectedIds.has(item.id)) {
                    selected.push(item);
                    selectedIds.add(item.id);
                }
                if (selected.length >= count) break;
            }
            if (selected.length < count && pool.length > 0) {
                while (selected.length < count) {
                    selected.push(pool[Math.floor(Math.random() * pool.length)]);
                }
            }
            return selected.sort(() => 0.5 - Math.random());
        };

        // --- 3. COMPONENTS ---

        // 3.1 Wheel (High Contrast B&W)
        const Wheel = ({ items, isSpinning, onSpinComplete, winner, theme, isMuted }) => {
            const [currentRotation, setCurrentRotation] = useState(0);
            const [hoveredItem, setHoveredItem] = useState(null);
            
            const SIZE = 400; const CENTER = SIZE / 2; const RADIUS = SIZE / 2 - 10;
            const safeItems = items.length > 0 ? items : [{ id: 'empty', name: 'Loading', icon: '...', category: 'fast_food', tags: [] }];
            const itemCount = safeItems.length;
            const SLICE_ANGLE = 360 / itemCount;

            const isDark = theme === 'dark';

            useEffect(() => {
                if (isSpinning && winner) {
                    setHoveredItem(null);
                    const winnerIndex = safeItems.findIndex(i => i.id === winner.id);
                    const targetIndex = winnerIndex >= 0 ? winnerIndex : 0;
                    
                    const extraSpins = 360 * 6; 
                    const anglePerSlice = 360 / itemCount;
                    const randomOffset = (Math.random() - 0.5) * (anglePerSlice * 0.8);
                    const baseTargetRotation = 360 - (targetIndex * anglePerSlice) - (anglePerSlice / 2) + randomOffset;
                    
                    setCurrentRotation(prev => {
                        const currentMod = prev % 360;
                        let delta = baseTargetRotation - currentMod;
                        if (delta < 0) delta += 360;
                        return prev + delta + extraSpins;
                    });

                    // Audio Logic
                    if (!isMuted) {
                        AudioEngine.init();
                        AudioEngine.resume();
                        
                        const totalDuration = 4000;
                        const startTime = Date.now();
                        
                        const playTick = () => {
                            const elapsed = Date.now() - startTime;
                            const progress = elapsed / totalDuration; // 0 to 1
                            
                            if (progress < 1) {
                                // Calculate next tick based on speed (cubic ease-out derivative approx)
                                // Speed starts fast (low interval) and slows down (high interval)
                                const baseInterval = 50;
                                const slowFactor = 300;
                                const nextInterval = baseInterval + (Math.pow(progress, 3) * slowFactor);
                                
                                AudioEngine.playClick();
                                setTimeout(playTick, nextInterval);
                            } else {
                                AudioEngine.playWin();
                                onSpinComplete();
                            }
                        };
                        
                        // Start the loop
                        playTick();
                    } else {
                        setTimeout(() => onSpinComplete(), 4000);
                    }
                }
            }, [isSpinning, winner, safeItems, isMuted]); 

            const getCoordinatesForPercent = (percent) => [Math.cos(2 * Math.PI * percent), Math.sin(2 * Math.PI * percent)];

            return (
                <div className="relative flex flex-col items-center justify-center">
                    <div className="relative w-[92vw] h-[92vw] max-w-[500px] max-h-[500px] flex items-center justify-center">
                        {/* Outer Glow Ring (Visual Boost) */}
                        <div className={`absolute inset-[-10px] rounded-full blur-xl opacity-30 ${isDark ? 'bg-white' : 'bg-black'} animate-pulse-slow`}></div>

                        {/* Pointer */}
                        <div className="absolute top-0 left-1/2 -translate-x-1/2 z-30 transform -translate-y-4 filter drop-shadow-[0_4px_8px_rgba(0,0,0,0.5)] pointer-events-none">
                           <svg width="48" height="60" viewBox="0 0 34 42" fill="none"><path d="M17 40L3 14L5 4H29L31 14L17 40Z" fill={isDark?"#E4E4E7":"#18181B"} stroke={isDark?"#52525b":"#000000"} strokeWidth="1"/></svg>
                        </div>
                        
                        {/* Wheel SVG */}
                        <div className="w-full h-full relative z-10" style={{ transform: `rotate(${currentRotation}deg)`, transition: isSpinning ? 'transform 4s cubic-bezier(0.2, 0, 0.1, 1)' : 'none' }}>
                            <svg viewBox={`0 0 ${SIZE} ${SIZE}`} className={`w-full h-full ${isDark ? 'drop-shadow-[0_0_20px_rgba(255,255,255,0.15)]' : 'drop-shadow-2xl'}`}>
                                <circle cx={CENTER} cy={CENTER} r={RADIUS} fill="#000000" />
                                {safeItems.map((item, index) => {
                                    const startPercent = (index / itemCount) - 0.25;
                                    const endPercent = ((index + 1) / itemCount) - 0.25;
                                    const [startX, startY] = getCoordinatesForPercent(startPercent);
                                    const [endX, endY] = getCoordinatesForPercent(endPercent);
                                    const pathData = [`M ${CENTER} ${CENTER}`, `L ${CENTER + RADIUS * startX} ${CENTER + RADIUS * startY}`, `A ${RADIUS} ${RADIUS} 0 ${1/itemCount > 0.5?1:0} 1 ${CENTER + RADIUS * endX} ${CENTER + RADIUS * endY}`, `Z`].join(' ');
                                    const isBlackSlice = index % 2 === 1;
                                    const angle = (index * SLICE_ANGLE) + (SLICE_ANGLE / 2) - 90;
                                    
                                    // High Contrast B&W Logic
                                    const sliceColor = isBlackSlice ? '#18181B' : '#FFFFFF';
                                    const textColor = isBlackSlice ? '#FFFFFF' : '#000000';
                                    const strokeColor = isBlackSlice ? '#333333' : '#E5E5E5';

                                    return (
                                        <g key={index} onMouseEnter={() => !isSpinning && setHoveredItem(item)} onMouseLeave={() => !isSpinning && setHoveredItem(null)} onTouchStart={() => !isSpinning && setHoveredItem(item)}>
                                            <path d={pathData} fill={sliceColor} stroke={strokeColor} strokeWidth="1"/>
                                            <g transform={`translate(${CENTER + RADIUS * 0.65 * Math.cos(angle * Math.PI / 180)}, ${CENTER + RADIUS * 0.65 * Math.sin(angle * Math.PI / 180)}) rotate(${angle + 90})`}>
                                                <text textAnchor="middle" fontSize="44" dy="2">{item.icon}</text>
                                                <text textAnchor="middle" fill={textColor} fontSize="13" fontWeight="900" dy="26">{item.name.substring(0,4)}</text>
                                            </g>
                                        </g>
                                    );
                                })}
                            </svg>
                        </div>
                        {/* Center Cat */}
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[12%] h-[12%] z-20 flex items-center justify-center pointer-events-none">
                            {USER_CAT_IMAGE_SRC ? (
                                <img src={USER_CAT_IMAGE_SRC} className="w-full h-full object-contain sticker-effect" alt="Cat" />
                            ) : (
                                <img src={DEFAULT_CAT_IMAGE} className="w-full h-full object-contain sticker-effect" alt="Cat" />
                            )}
                        </div>
                    </div>
                     <div className="absolute bottom-[20px] left-1/2 -translate-x-1/2 z-20 pointer-events-none transition-all duration-300 w-full flex justify-center">
                        <div className={`backdrop-blur-md border px-4 py-2 rounded-xl shadow-lg w-auto max-w-[240px] text-center transition-opacity duration-300 ${hoveredItem ? 'opacity-100' : 'opacity-0'} ${isDark ? 'bg-black/80 border-white/10 text-zinc-200' : 'bg-white/80 border-black/10 text-zinc-900'}`}>
                            <div className="text-[12px] font-medium leading-tight">{hoveredItem?.description || '...'}</div>
                        </div>
                    </div>
                </div>
            );
        };

        // 3.2 Result Card (Enhanced Poster + Live Preview)
        const ResultCard = ({ winner, onClose, onRetry, isFavorite, onToggleFavorite, theme, onBanSession }) => {
            const [isGenerating, setIsGenerating] = useState(false);
            const [posterTheme, setPosterTheme] = useState('white'); // white, black, red
            
            if (!winner) return null;

            const getDisplayLabel = (item) => {
                if (item.tags.includes('ÂÆµÂ§ú')) return 'ÂÆµÂ§ú';
                if (item.tags.includes('ÁîúÂìÅ')) return 'ÁîúÂìÅ';
                if (item.tags.includes('È•ÆÂìÅ')) return 'È•ÆÂìÅ';
                if (item.tags.includes('Êó©È§ê')) return 'Êó©È§ê';
                return CATEGORY_LABELS[item.category] || 'ÁæéÈ£ü';
            };

            const displayLabel = getDisplayLabel(winner);

            const copyName = () => {
                navigator.clipboard.writeText(winner.name);
                alert(`Â∑≤Â§çÂà∂: ${winner.name}`);
            }

            const handleShare = async () => {
                if (isGenerating) return;
                setIsGenerating(true);
                
                // Generate High-Res Poster for Export
                const poster = document.createElement('div');
                
                // Theme logic for export (same as preview)
                let bg = 'white'; let text = 'black'; let border = '#e5e5e5';
                if (posterTheme === 'black') { bg = '#09090b'; text = 'white'; border = '#27272a'; }
                if (posterTheme === 'red') { bg = 'linear-gradient(135deg, #ef4444 0%, #b91c1c 100%)'; text = '#fffbeb'; border = '#fecaca'; }

                const texture = `background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");`;

                poster.style.cssText = `position:fixed;top:0;left:0;width:375px;height:auto;min-height:600px;padding:40px 20px;text-align:center;z-index:-1;font-family:sans-serif;display:block;background:${bg};color:${text};`;
                
                // Fix: Increased top margin to prevent overlap with line
                // Clean Layout without pill box
                poster.innerHTML = `
                    <div style="position:absolute;inset:0;${texture}pointer-events:none;"></div>
                    <div style="font-size:12px;opacity:0.6;letter-spacing:4px;margin-bottom:20px;text-align:center;text-transform:uppercase;">Today's Choice</div>
                    
                    <div style="font-size:100px;margin:10px auto 20px auto;text-align:center;display:block;filter:drop-shadow(0 10px 20px rgba(0,0,0,0.2));">${winner.icon}</div>
                    
                    <h1 style="font-size:42px;font-weight:900;margin:0 0 10px 0;color:${text};text-align:center;line-height:1.1;">${winner.name}</h1>
                    
                    <div style="font-size:14px; font-weight:bold; opacity:0.8; margin-bottom:30px; border-top:1px solid ${border}; border-bottom:1px solid ${border}; padding:8px 0; width:100%; margin-top:20px;">
                        ${displayLabel}
                    </div>
                    
                    <p style="font-size:15px;opacity:0.9;margin:0 auto 60px auto;max-width:85%;line-height:1.8;text-align:center;font-weight:500;">${winner.description}</p>
                    <div style="border-top:1px solid ${border};padding-top:25px;font-size:10px;opacity:0.5;text-align:center;letter-spacing:1px;">EAT ¬∑ DECISION MAKER</div>
                `;
                
                document.body.appendChild(poster);
                
                try {
                    const canvas = await html2canvas(poster, { scale: 2, useCORS: true });
                    document.body.removeChild(poster);
                    const blob = await new Promise(r => canvas.toBlob(r));
                    const file = new File([blob], "share.png", { type: "image/png" });
                    
                    if (navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({ files: [file] });
                    } else {
                        const a = document.createElement('a'); a.href = canvas.toDataURL(); a.download = 'eat.png'; a.click();
                    }
                } catch (e) { console.error(e); if(document.body.contains(poster)) document.body.removeChild(poster); }
                setIsGenerating(false);
            };

            // --- Dynamic Preview Styles for UI ---
            const cardBgClass = posterTheme === 'white' ? 'bg-white text-black' 
                              : posterTheme === 'black' ? 'bg-zinc-900 text-white' 
                              : 'bg-gradient-to-br from-red-600 to-red-800 text-white';
            
            const cardBorderClass = posterTheme === 'white' ? 'border-zinc-100' 
                                  : posterTheme === 'black' ? 'border-zinc-800' 
                                  : 'border-red-400/30';
            
            const subTextClass = posterTheme === 'white' ? 'text-zinc-500' 
                               : posterTheme === 'black' ? 'text-zinc-400' 
                               : 'text-white/80';

            const dividerClass = posterTheme === 'white' ? 'border-zinc-200' 
                               : posterTheme === 'black' ? 'border-zinc-800' 
                               : 'border-white/20';

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-in fade-in" onClick={(e) => {e.stopPropagation(); onClose();}}>
                    {/* Main Container */}
                    <div className={`w-full max-w-sm rounded-3xl p-8 text-center shadow-2xl relative transition-colors duration-500 border ${cardBgClass} ${cardBorderClass}`} onClick={e=>e.stopPropagation()}>
                        
                        {/* Close Button */}
                        <button onClick={onClose} className={`absolute top-4 right-4 p-2 rounded-full transition-colors ${posterTheme === 'white' ? 'bg-gray-100 hover:bg-gray-200 text-black' : 'bg-white/10 hover:bg-white/20 text-white'}`}>
                            <Icons.X className="w-5 h-5"/>
                        </button>

                        <div className={`text-xs font-bold tracking-widest mb-6 ${subTextClass}`}>ÂÜ≥ÂÆö‰∫ÜÔºÅÂ∞±ÊòØÂÆÉÔºÅ</div>
                        
                        <div className="relative inline-block" onClick={copyName} title="ÁÇπÂáªÂ§çÂà∂">
                             {isFavorite && <div className="absolute -top-2 -right-2 bg-yellow-400 p-1.5 rounded-full shadow-lg"><Icons.Star className="w-4 h-4 text-white fill-white"/></div>}
                             <div className="text-8xl mb-4 drop-shadow-2xl active:scale-95 transition-transform">{winner.icon}</div>
                        </div>
                        
                        <h2 className="text-3xl font-black mb-2 flex items-center justify-center gap-2" onClick={copyName}>{winner.name}</h2>
                        
                        {/* Fix: Removed Pill Box, use simple divider lines with margin to prevent overlap */}
                        <div className="mb-6 flex justify-center w-full mt-4">
                             <span className={`text-xs font-bold w-full py-2 border-t border-b ${dividerClass} ${subTextClass}`}>{displayLabel}</span>
                        </div>

                        <p className={`text-sm mb-8 px-4 leading-relaxed font-medium min-h-[3rem] ${subTextClass}`}>{winner.description}</p>
                        
                        {/* Poster Theme Selector */}
                        <div className="mb-6">
                            <div className={`text-[10px] mb-2 uppercase font-bold tracking-wider opacity-60`}>Êµ∑Êä•‰∏ªÈ¢ò (ÂÆûÊó∂È¢ÑËßà)</div>
                            <div className="flex justify-center gap-4">
                                <button onClick={() => setPosterTheme('white')} className={`w-8 h-8 rounded-full border-2 bg-white shadow-lg transition-transform ${posterTheme==='white' ? 'border-blue-500 scale-110' : 'border-transparent opacity-70 hover:opacity-100 hover:scale-105'}`} title="ÊûÅÁÆÄÁôΩ"></button>
                                <button onClick={() => setPosterTheme('black')} className={`w-8 h-8 rounded-full border-2 bg-zinc-900 shadow-lg transition-transform ${posterTheme==='black' ? 'border-blue-500 scale-110' : 'border-zinc-500 opacity-70 hover:opacity-100 hover:scale-105'}`} title="ÊöóÂ§úÈªë"></button>
                                <button onClick={() => setPosterTheme('red')} className={`w-8 h-8 rounded-full border-2 bg-gradient-to-br from-red-500 to-red-600 shadow-lg transition-transform ${posterTheme==='red' ? 'border-yellow-400 scale-110' : 'border-transparent opacity-70 hover:opacity-100 hover:scale-105'}`} title="Èî¶È≤§Á∫¢"></button>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-3 mb-3">
                            {/* Share Button - Adaptive */}
                            <button 
                                onClick={handleShare} 
                                disabled={isGenerating} 
                                className={`py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-lg hover:opacity-90
                                    ${posterTheme === 'white' ? 'bg-black text-white' : 'bg-white text-black'}
                                `}
                            >
                                <Icons.Share2 className="w-4 h-4"/> ÂàÜ‰∫´
                            </button>
                            
                            {/* Retry Button - Adaptive */}
                            <button 
                                onClick={onRetry} 
                                className={`py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all
                                    ${posterTheme === 'white' ? 'bg-gray-100 text-black hover:bg-gray-200' : 'bg-white/10 text-white hover:bg-white/20'}
                                `}
                            >
                                <Icons.RefreshCw className="w-4 h-4"/> ÈáçÈÄâ
                            </button>
                        </div>
                        
                        <button onClick={onBanSession} className="w-full py-2 mb-4 text-xs opacity-50 hover:opacity-100 hover:text-red-400 flex items-center justify-center gap-1 transition-colors">
                            <Icons.Ban className="w-3 h-3"/> ‰ªäÂ§©‰∏çÊÉ≥ÂêÉËøô‰∏™ (‰∏¥Êó∂ÂâîÈô§)
                        </button>

                        <div className="flex justify-center">
                            <button onClick={onToggleFavorite} className={`text-xs font-bold flex items-center gap-1 transition-colors ${isFavorite ? 'text-yellow-400' : 'opacity-40 hover:opacity-100'}`}><Icons.Star className={`w-3 h-3 ${isFavorite?'fill-yellow-400':''}`}/> {isFavorite?'Â∑≤Êî∂Ëóè':'Êî∂Ëóè'}</button>
                        </div>
                    </div>
                </div>
            );
        };

        // 3.3 Add Food Modal
        const AddFoodModal = ({ isOpen, onClose, onAdd, initialItem, navTabs }) => {
            const [name, setName] = useState('');
            const [icon, setIcon] = useState('üòã');
            const [category, setCategory] = useState('chinese');
            const [tags, setTags] = useState('');
            const [description, setDescription] = useState('');

            useEffect(() => {
                if (isOpen && initialItem) {
                    setName(initialItem.name);
                    setIcon(initialItem.icon);
                    setCategory(initialItem.category);
                    setTags(initialItem.tags.join(', '));
                    setDescription(initialItem.description || '');
                } else if (isOpen) {
                    setName(''); setIcon('üòã'); setCategory('chinese'); setTags(''); setDescription('');
                }
            }, [isOpen, initialItem]);

            const handleSubmit = (e) => {
                e.preventDefault();
                const newItem = {
                    id: initialItem ? initialItem.id : `custom_${Date.now()}`,
                    name: name.trim(), icon: icon.trim() || 'ü•ò', category,
                    tags: tags.split(/[,Ôºå\s]+/).filter(t => t.trim()),
                    description: description.trim()
                };
                onAdd(newItem); onClose();
            };

            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-md max-h-[90vh] overflow-y-auto rounded-2xl p-6 border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="flex justify-between mb-4"><h2 className="text-lg font-bold">{initialItem?'ÁºñËæë':'Ê∑ªÂä†'}ÁæéÈ£ü</h2><button onClick={onClose}><Icons.X className="text-zinc-400"/></button></div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input value={name} onChange={e=>setName(e.target.value)} placeholder="ÂêçÁß∞" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl border-none outline-none focus:ring-2 focus:ring-zinc-500" required/>
                            <div className="flex gap-2">
                                <input value={icon} onChange={e=>setIcon(e.target.value)} className="w-16 bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl text-center border-none outline-none focus:ring-2 focus:ring-zinc-500" />
                                <select value={category} onChange={e=>setCategory(e.target.value)} className="flex-1 bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl border-none outline-none focus:ring-2 focus:ring-zinc-500">
                                    {Object.entries(CATEGORY_LABELS).map(([k,v])=><option key={k} value={k}>{v}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="text-[10px] text-zinc-500 mb-1 block">Êé®ËçêÊ†áÁ≠æÈ°∫Â∫è: Á±ªÂûã, Âú∞Âüü, Âè£Âë≥</label>
                                <input value={tags} onChange={e=>setTags(e.target.value)} placeholder="Ê†áÁ≠æ (ÈÄóÂè∑ÂàÜÈöî)" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl mb-2 border-none outline-none focus:ring-2 focus:ring-zinc-500"/>
                                <div className="flex flex-wrap gap-1">{navTabs.map(t=>t.filterTags.map(tag=><button type="button" key={tag} onClick={()=>setTags(prev=>prev?prev+', '+tag:tag)} className="text-[10px] bg-gray-100 dark:bg-zinc-800 px-2 py-1 rounded border border-gray-200 dark:border-zinc-700 hover:bg-gray-200 dark:hover:bg-zinc-700">{tag}</button>))}</div>
                                <div className="mt-2 text-[10px] text-zinc-600 dark:text-zinc-400">
                                    È¢ÑËßà: {tags.split(/[,Ôºå\s]+/).filter(t=>t).map((t,i)=><span key={i} className={`mr-1 px-1 rounded ${i===0?'bg-zinc-200 dark:bg-zinc-700':i===1?'bg-zinc-100 dark:bg-zinc-800':'bg-gray-50 dark:bg-zinc-900'}`}>{t}</span>)}
                                </div>
                            </div>
                            <textarea value={description} onChange={e=>setDescription(e.target.value)} placeholder="ÁÆÄ‰ªã" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl border-none outline-none focus:ring-2 focus:ring-zinc-500" rows={2}/>
                            <button type="submit" className="w-full py-3 bg-black dark:bg-white text-white dark:text-black font-bold rounded-xl">‰øùÂ≠ò</button>
                        </form>
                    </div>
                </div>
            );
        };

        // 3.4 Category Manager
        const CategoryManager = ({ isOpen, onClose, tabs, onUpdateTabs }) => {
            const [editingTab, setEditingTab] = useState(null);
            const [localTagInput, setLocalTagInput] = useState('');

            if (!isOpen) return null;
            
            const handleSave = () => {
                if(!editingTab.label) return;
                const tagsArray = localTagInput.split(/[,Ôºå\s]+/).filter(t=>t);
                const newTab = { ...editingTab, filterTags: tagsArray };
                delete newTab.isNew; 
                const newTabs = editingTab.isNew ? [...tabs, {...newTab, id: `tab_${Date.now()}`}] : tabs.map(t=>t.id===newTab.id?newTab:t);
                onUpdateTabs(newTabs); 
                setEditingTab(null);
                setLocalTagInput('');
            };

            const startEdit = (tab) => {
                setEditingTab({...tab});
                setLocalTagInput(tab.filterTags ? tab.filterTags.join(', ') : '');
            }

            const startAdd = () => {
                setEditingTab({ id: `tab_${Date.now()}`, label: '', iconName: 'Layers', filterTags: [], isSystem: false, isNew: true });
                setLocalTagInput('');
            }

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-md max-h-[85vh] overflow-y-auto rounded-2xl p-6 border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="flex justify-between mb-4"><h2 className="text-lg font-bold">ÂàÜÁ±ªÁÆ°ÁêÜ</h2><button onClick={onClose}><Icons.X className="text-zinc-400"/></button></div>
                        {editingTab ? (
                            <div className="space-y-3">
                                <input value={editingTab.label} onChange={e=>setEditingTab({...editingTab, label:e.target.value})} placeholder="ÂàÜÁ±ªÂêçÁß∞" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl"/>
                                <input value={localTagInput} onChange={e=>setLocalTagInput(e.target.value)} placeholder="Á≠õÈÄâÊ†áÁ≠æ (ÈÄóÂè∑ÂàÜÈöî)" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl"/>
                                <div className="flex gap-2"><button onClick={handleSave} className="flex-1 bg-black dark:bg-white text-white dark:text-black py-2 rounded-lg font-bold">‰øùÂ≠ò</button><button onClick={() => setEditingTab(null)} className="flex-1 bg-gray-100 dark:bg-zinc-800 py-2 rounded-lg">ÂèñÊ∂à</button></div>
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {tabs.map(t=>(
                                    <div key={t.id} className="flex justify-between bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl items-center border border-gray-100 dark:border-zinc-700">
                                        <span>{t.label}</span>
                                        <div className="flex gap-2">
                                            <button onClick={()=>startEdit(t)}><Icons.Edit className="w-4 h-4 text-zinc-400"/></button>
                                            <button onClick={()=>onUpdateTabs(tabs.filter(x=>x.id!==t.id))}><Icons.Trash2 className="w-4 h-4 text-red-400"/></button>
                                        </div>
                                    </div>
                                ))}
                                <button onClick={startAdd} className="w-full py-3 border border-dashed border-zinc-300 dark:border-zinc-700 text-zinc-500 rounded-xl font-bold flex justify-center items-center gap-2 hover:bg-gray-50 dark:hover:bg-zinc-800"><Icons.Plus className="w-4 h-4"/> Ê∑ªÂä†ÂàÜÁ±ª</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 3.5 Settings
        const Settings = ({ isOpen, onClose, prefs, updatePrefs, allFoodItems, theme, toggleTheme, isMuted, toggleMute }) => {
            const fileInputRef = useRef(null);
            if (!isOpen) return null;
            
            const toggle = (arr, val) => arr.includes(val) ? arr.filter(x=>x!==val) : [...arr, val];
            const handleExport = () => {
                const data = JSON.stringify({prefs, date: new Date().toISOString()});
                const blob = new Blob([data], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = 'eat_backup.json'; a.click();
            };
            const handleImport = (e) => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => { try { const p = JSON.parse(ev.target.result); if(p.prefs) updatePrefs(p.prefs); alert('ÊÅ¢Â§çÊàêÂäü'); window.location.reload(); } catch(err){alert('Êñá‰ª∂ÈîôËØØ');} };
                    reader.readAsText(file);
                }
            };

            const toggleFavoriteActive = (id) => {
                const ignored = prefs.ignoredFavoriteIds || [];
                const newIgnored = ignored.includes(id) ? ignored.filter(i => i !== id) : [...ignored, id];
                updatePrefs({...prefs, ignoredFavoriteIds: newIgnored});
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-md h-[85vh] rounded-2xl p-6 border border-zinc-200 dark:border-zinc-800 flex flex-col shadow-2xl text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="flex justify-between mb-4"><h2 className="text-lg font-bold">ÂÅèÂ•ΩËÆæÁΩÆ</h2><button onClick={onClose}><Icons.X className="text-zinc-400"/></button></div>
                        <div className="flex-1 overflow-y-auto space-y-6 pr-2">
                             
                             {/* Theme & Sound Toggle */}
                             <section className="grid grid-cols-2 gap-3">
                                <div className="flex items-center justify-between p-3 rounded-xl border bg-gray-50 dark:bg-zinc-800 border-gray-100 dark:border-zinc-700">
                                    <div className="flex items-center gap-2 text-xs font-bold">
                                        {theme === 'dark' ? <Icons.Moon className="w-4 h-4"/> : <Icons.Sun className="w-4 h-4"/>} Ê®°Âºè
                                    </div>
                                    <button onClick={toggleTheme} className="px-3 py-1 rounded text-xs font-bold border transition-all bg-white dark:bg-black border-gray-200 dark:border-zinc-600">ÂàáÊç¢</button>
                                </div>
                                <div className="flex items-center justify-between p-3 rounded-xl border bg-gray-50 dark:bg-zinc-800 border-gray-100 dark:border-zinc-700">
                                    <div className="flex items-center gap-2 text-xs font-bold">
                                        {isMuted ? <Icons.VolumeX className="w-4 h-4"/> : <Icons.Volume2 className="w-4 h-4"/>} Èü≥Êïà
                                    </div>
                                    <button onClick={toggleMute} className={`px-3 py-1 rounded text-xs font-bold border transition-all ${isMuted ? 'bg-zinc-200 dark:bg-zinc-700' : 'bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 border-green-200 dark:border-green-800'}`}>{isMuted ? 'ÂÖ≥' : 'ÂºÄ'}</button>
                                </div>
                             </section>

                             <section>
                                <div className="flex items-center justify-between mb-3">
                                    <h3 className="text-xs font-bold text-zinc-500 uppercase">‰ºòÂÖàÊé®ËçêÊî∂Ëóè</h3>
                                    <button onClick={() => updatePrefs({...prefs, prioritizeFavorites: !prefs.prioritizeFavorites})} className={`flex items-center gap-2 ${prefs.prioritizeFavorites ? "text-yellow-500" : "text-zinc-400"}`}>
                                        {prefs.prioritizeFavorites ? <Icons.ToggleRight className="w-8 h-8"/> : <Icons.ToggleLeft className="w-8 h-8"/>}
                                    </button>
                                </div>
                                {prefs.prioritizeFavorites && (
                                    <div className="flex flex-wrap gap-2">
                                        {(prefs.favoriteItemIds||[]).map(id => {
                                            const item = allFoodItems.find(i=>i.id===id);
                                            if(!item) return null;
                                            const isActive = !(prefs.ignoredFavoriteIds||[]).includes(id);
                                            return (
                                                <button key={id} onClick={() => toggleFavoriteActive(id)} className={`px-2 py-1 rounded-lg text-xs border ${isActive ? 'bg-yellow-100 dark:bg-yellow-900/30 border-yellow-300 dark:border-yellow-700 text-yellow-700 dark:text-yellow-200' : 'bg-gray-100 dark:bg-zinc-800 border-gray-200 dark:border-zinc-700 text-zinc-400 line-through'}`}>
                                                    {item.name}
                                                </button>
                                            )
                                        })}
                                    </div>
                                )}
                            </section>
                            <section>
                                <h3 className="text-xs font-bold text-zinc-500 mb-2 uppercase">Âè£Âë≥Â±èËîΩ</h3>
                                <div className="grid grid-cols-4 gap-2">{FLAVOR_OPTIONS.map(f=><button key={f} onClick={()=>updatePrefs({...prefs, excludedTags:toggle(prefs.excludedTags,f)})} className={`py-2 rounded text-xs border ${prefs.excludedTags.includes(f)?'bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800 text-red-500 dark:text-red-400 line-through':'bg-gray-50 dark:bg-zinc-800 border-gray-200 dark:border-zinc-700'}`}>{f}</button>)}</div>
                            </section>
                            <section>
                                <h3 className="text-xs font-bold text-zinc-500 mb-2 uppercase">ËèúÁ≥ªÂ±èËîΩ</h3>
                                <div className="grid grid-cols-4 gap-2">{GEO_OPTIONS.map(g=><button key={g} onClick={()=>updatePrefs({...prefs, excludedTags:toggle(prefs.excludedTags,g)})} className={`py-2 rounded text-xs border ${prefs.excludedTags.includes(g)?'bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800 text-red-500 dark:text-red-400 line-through':'bg-gray-50 dark:bg-zinc-800 border-gray-200 dark:border-zinc-700'}`}>{g}</button>)}</div>
                            </section>
                            <section className="bg-gray-50 dark:bg-zinc-950 p-4 rounded-xl border border-gray-200 dark:border-zinc-800">
                                <h3 className="text-xs font-bold text-zinc-500 mb-2 uppercase">Êï∞ÊçÆÂ§á‰ªΩ</h3>
                                <div className="flex gap-2">
                                    <button onClick={handleExport} className="flex-1 bg-white dark:bg-zinc-800 py-2 rounded text-xs border border-gray-200 dark:border-zinc-700"><Icons.Download className="w-3 h-3 inline mr-1"/> ÂØºÂá∫</button>
                                    <button onClick={()=>fileInputRef.current.click()} className="flex-1 bg-white dark:bg-zinc-800 py-2 rounded text-xs border border-gray-200 dark:border-zinc-700"><Icons.Upload className="w-3 h-3 inline mr-1"/> ÂØºÂÖ•</button>
                                    <input type="file" ref={fileInputRef} hidden onChange={handleImport} accept=".json"/>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            );
        };

        // 3.6 Food Details Modal
        const FoodDetailModal = ({ isOpen, onClose, item, onEdit, isFav, onToggleFav }) => {
            if(!isOpen || !item) return null;
            return (
                <div className="fixed inset-0 z-[55] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-in fade-in" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-sm rounded-3xl p-8 text-center shadow-2xl relative border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <button onClick={onEdit} className="absolute top-4 right-4 p-2 bg-gray-100 dark:bg-zinc-800 rounded-full text-zinc-400 hover:text-black dark:hover:text-white"><Icons.Edit2 className="w-5 h-5"/></button>
                        <div className="text-8xl mb-6">{item.icon}</div>
                        <h2 className="text-3xl font-black mb-2">{item.name}</h2>
                        <div className="flex flex-wrap gap-2 justify-center mb-6">
                            {item.tags.map(t=>(
                                <span key={t} className="px-2 py-1 bg-gray-100 dark:bg-zinc-800 rounded-md text-xs text-zinc-500 dark:text-zinc-400">{t}</span>
                            ))}
                        </div>
                        <p className="text-sm text-zinc-500 mb-8 leading-relaxed">{item.description}</p>
                        <button onClick={onToggleFav} className={`w-full py-3 rounded-xl font-bold border flex items-center justify-center gap-2 ${isFav?'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700 text-yellow-600 dark:text-yellow-500':'bg-gray-100 dark:bg-zinc-950 border-gray-200 dark:border-zinc-800 text-zinc-400'}`}>
                            <Icons.Star className={`w-4 h-4 ${isFav?'fill-yellow-500':''}`}/> {isFav?'Â∑≤Êî∂Ëóè':'Âä†ÂÖ•Êî∂Ëóè'}
                        </button>
                    </div>
                </div>
            )
        }

        // 3.7 Food Library
        const FoodLibrary = ({ isOpen, onClose, items, onEdit, favs, onToggleFav, navTabs }) => {
            const [search, setSearch] = useState('');
            const [activeTabId, setActiveTabId] = useState('all');
            const [showFavsOnly, setShowFavsOnly] = useState(false);
            const [viewingItem, setViewingItem] = useState(null);

            if(!isOpen) return null;
            
            const getDisplayLabel = (item) => {
                if (item.tags.includes('ÂÆµÂ§ú')) return 'ÂÆµÂ§ú';
                if (item.tags.includes('ÁîúÂìÅ')) return 'ÁîúÂìÅ';
                if (item.tags.includes('È•ÆÂìÅ')) return 'È•ÆÂìÅ';
                if (item.tags.includes('Êó©È§ê')) return 'Êó©È§ê';
                return CATEGORY_LABELS[item.category];
            };

            const filtered = items.filter(item => {
                if (showFavsOnly && !favs.includes(item.id)) return false;
                if (search && !item.name.includes(search) && !item.tags.some(t=>t.includes(search))) return false;
                if (activeTabId !== 'all') {
                    const tab = navTabs.find(t=>t.id===activeTabId);
                    if (tab && tab.filterTags.length > 0 && !tab.filterTags.some(tag=>item.tags.includes(tag))) return false;
                }
                return true;
            });

            return (
                <>
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-950 w-full max-w-2xl h-[85vh] rounded-2xl flex flex-col border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="p-4 border-b border-zinc-200 dark:border-zinc-800 flex justify-between"><h2 className="font-bold">ÁæéÈ£üÂõæÈâ¥</h2><button onClick={onClose}><Icons.X/></button></div>
                        <div className="p-4 space-y-3 border-b border-zinc-200 dark:border-zinc-800">
                             <div className="flex gap-2">
                                <div className="relative flex-1"><Icons.Search className="absolute left-3 top-2.5 w-4 h-4 text-zinc-500"/><input value={search} onChange={e=>setSearch(e.target.value)} placeholder="ÊêúÁ¥¢..." className="w-full bg-gray-50 dark:bg-zinc-900 pl-9 p-2 rounded-xl border border-gray-200 dark:border-zinc-800 focus:outline-none focus:ring-2 focus:ring-zinc-500"/></div>
                                <button onClick={()=>setShowFavsOnly(!showFavsOnly)} className={`p-2 rounded-xl border ${showFavsOnly?'bg-yellow-50 dark:bg-yellow-900/30 border-yellow-200 dark:border-yellow-700 text-yellow-500':'bg-gray-50 dark:bg-zinc-900 border-gray-200 dark:border-zinc-800 text-zinc-400'}`}><Icons.Star className={`w-5 h-5 ${showFavsOnly?'fill-yellow-500':''}`}/></button>
                             </div>
                             <div className="flex gap-2 overflow-x-auto scrollbar-hide">
                                {navTabs.map(t=>(<button key={t.id} onClick={()=>setActiveTabId(t.id)} className={`px-3 py-1 rounded-full text-xs border ${activeTabId===t.id?'bg-black dark:bg-white text-white dark:text-black border-black dark:border-white':'bg-gray-50 dark:bg-zinc-900 border-gray-200 dark:border-zinc-800 text-zinc-500'}`}>{t.label}</button>))}
                             </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 grid grid-cols-3 gap-3 content-start">
                            {filtered.map(item=>(
                                <div key={item.id} className="bg-gray-50 dark:bg-zinc-900/50 p-3 rounded-xl border border-gray-200 dark:border-zinc-800 text-center relative group aspect-square flex flex-col items-center justify-center hover:border-zinc-400 dark:hover:border-zinc-600 transition-colors" onClick={()=>setViewingItem(item)}>
                                    <div className="absolute top-1 right-1"><Icons.Star className={`w-3 h-3 ${favs.includes(item.id)?'fill-yellow-500 text-yellow-500':'text-gray-300 dark:text-zinc-800'}`}/></div>
                                    <div className="text-3xl mb-1">{item.icon}</div>
                                    <div className="text-xs font-bold truncate w-full px-1">{item.name}</div>
                                    <div className="text-[10px] text-zinc-500 mt-1">{getDisplayLabel(item)}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
                <FoodDetailModal 
                    isOpen={!!viewingItem} 
                    item={viewingItem} 
                    onClose={()=>setViewingItem(null)} 
                    onEdit={()=>{setViewingItem(null); onEdit(viewingItem)}}
                    isFav={viewingItem && favs.includes(viewingItem.id)}
                    onToggleFav={()=>onToggleFav(viewingItem.id)}
                />
                </>
            );
        };

        // 3.8 History
        const History = ({ isOpen, onClose, history, onClear }) => {
            if(!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-sm h-[70vh] rounded-2xl p-6 flex flex-col border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="flex justify-between mb-4"><h2 className="font-bold">ÂéÜÂè≤ËÆ∞ÂΩï</h2><button onClick={onClose}><Icons.X/></button></div>
                        <div className="flex-1 overflow-y-auto space-y-2">
                            {history.slice().reverse().map((h,i)=>(
                                <div key={i} className="flex items-center gap-3 p-2 bg-gray-50 dark:bg-zinc-800/50 rounded-lg">
                                    <span className="text-xl">{h.food.icon}</span>
                                    <div><div className="text-sm font-bold">{h.food.name}</div><div className="text-[10px] text-zinc-500">{new Date(h.timestamp).toLocaleString('zh-CN', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</div></div>
                                </div>
                            ))}
                        </div>
                        {history.length>0 && <button onClick={onClear} className="mt-2 text-xs text-red-500 hover:text-red-600 underline text-center w-full py-2">Ê∏ÖÁ©∫ÂéÜÂè≤</button>}
                    </div>
                </div>
            );
        };

        // --- 4. MAIN APP ---
        const App = () => {
            const [items, setItems] = useState([]);
            const [isSpinning, setIsSpinning] = useState(false);
            const [winner, setWinner] = useState(null);
            const [navTabs, setNavTabs] = useState(DEFAULT_NAV_TABS);
            const [activeTabId, setActiveTabId] = useState('all');
            const [prefs, setPrefs] = useState({ excludedCategories: [], excludedTags: [], favoriteItemIds: [], prioritizeFavorites: true, ignoredFavoriteIds: [], sessionBannedIds: [] });
            const [history, setHistory] = useState([]);
            const [customItems, setCustomItems] = useState([]);
            const [foodOverrides, setFoodOverrides] = useState({});
            const [theme, setTheme] = useState('dark');
            const [isMuted, setIsMuted] = useState(false);
            const [greeting, setGreeting] = useState('‰ªäÂ§©ÂêÉ‰ªÄ‰πà');
            
            // Modals
            const [modals, setModals] = useState({ settings: false, history: false, add: false, library: false, catManager: false });
            const [editingItem, setEditingItem] = useState(null);

            // Drag to scroll refs
            const navScrollRef = useRef(null);
            const [isDraggingNav, setIsDraggingNav] = useState(false);
            const [navStartX, setNavStartX] = useState(0);
            const [navScrollLeft, setNavScrollLeft] = useState(0);

            // Theme Init
            useEffect(() => {
                const savedTheme = localStorage.getItem('eat_theme') || 'dark';
                setTheme(savedTheme);
                document.documentElement.classList.toggle('dark', savedTheme === 'dark');
            }, []);

            // Time Awareness
            useEffect(() => {
                const hour = new Date().getHours();
                let targetTab = 'all';
                let greet = '‰ªäÂ§©ÂêÉ‰ªÄ‰πà';

                if (hour >= 6 && hour < 10) { targetTab = 'breakfast'; greet = 'Êó©ÂÆâÔºåÂêÉÈ°øÂ•ΩÁöÑ'; } 
                else if (hour >= 14 && hour < 17) { targetTab = 'dessert'; greet = '‰∏ãÂçàËå∂Êó∂Èó¥Âà∞'; }
                else if (hour >= 22 || hour < 4) { targetTab = 'night'; greet = 'Ê∑±Â§ú‰∫ÜÔºåÊï¥ÁÇπÂ§úÂÆµÔºü'; }
                else { targetTab = 'meal'; greet = 'Âπ≤È•≠‰∫∫ÔºåÂπ≤È•≠È≠Ç'; }

                setGreeting(greet);
                
                const hasTab = navTabs.find(t => t.id === targetTab);
                if (hasTab) {
                    setActiveTabId(targetTab);
                }
            }, [navTabs]);

            const toggleTheme = () => {
                const newTheme = theme === 'dark' ? 'light' : 'dark';
                setTheme(newTheme);
                localStorage.setItem('eat_theme', newTheme);
                document.documentElement.classList.toggle('dark', newTheme === 'dark');
            }

            const toggleMute = () => {
                setIsMuted(!isMuted);
                if (AudioEngine.ctx && AudioEngine.ctx.state === 'running') AudioEngine.ctx.suspend();
                else if (AudioEngine.ctx && AudioEngine.ctx.state === 'suspended') AudioEngine.ctx.resume();
            }

            // Init
            useEffect(() => {
                const lp = localStorage.getItem('eat_prefs'); if(lp) setPrefs(JSON.parse(lp));
                const lh = localStorage.getItem('eat_history'); if(lh) setHistory(JSON.parse(lh));
                const lc = localStorage.getItem('eat_custom'); if(lc) setCustomItems(JSON.parse(lc));
                const lo = localStorage.getItem('eat_overrides'); if(lo) setFoodOverrides(JSON.parse(lo));
                const lt = localStorage.getItem('eat_tabs'); if(lt) setNavTabs(JSON.parse(lt));
            }, []);

            // Save
            useEffect(() => localStorage.setItem('eat_prefs', JSON.stringify(prefs)), [prefs]);
            useEffect(() => localStorage.setItem('eat_history', JSON.stringify(history)), [history]);
            useEffect(() => localStorage.setItem('eat_custom', JSON.stringify(customItems)), [customItems]);
            useEffect(() => localStorage.setItem('eat_overrides', JSON.stringify(foodOverrides)), [foodOverrides]);
            useEffect(() => localStorage.setItem('eat_tabs', JSON.stringify(navTabs)), [navTabs]);

            // Compute Data
            const allItems = useMemo(() => {
                const builtins = FOOD_DATABASE.map(i => foodOverrides[i.id] ? {...i, ...foodOverrides[i.id]} : i);
                return [...builtins, ...customItems];
            }, [customItems, foodOverrides]);

            const generatePool = useCallback(() => {
                const tab = navTabs.find(t=>t.id===activeTabId) || navTabs[0];
                return getRandomBatch(8, prefs, tab, allItems);
            }, [activeTabId, prefs, allItems, navTabs]);

            useEffect(() => {
                if(!isSpinning) {
                    setItems(generatePool());
                }
            }, [activeTabId, prefs, allItems, navTabs]);

            const handleSpin = () => { 
                if(!isSpinning && items.length > 0) { 
                    setIsSpinning(true); 
                    const winnerIndex = Math.floor(Math.random() * items.length);
                    const selectedWinner = items[winnerIndex];
                    setWinner(selectedWinner); 
                } 
            };

            const handleSpinComplete = () => {
                setIsSpinning(false); 
                if(winner) setHistory(h=>[...h,{food:winner, timestamp:Date.now()}]);
            };

            const handleSaveItem = (item) => {
                if(item.id.startsWith('custom_')) {
                    setCustomItems(prev => { const idx=prev.findIndex(i=>i.id===item.id); if(idx>=0){const n=[...prev];n[idx]=item;return n;} return [...prev,item]; });
                } else {
                    setFoodOverrides(prev=>({...prev, [item.id]: item}));
                }
            };

            const banSession = () => {
                if(!winner) return;
                setPrefs(p => ({...p, sessionBannedIds: [...(p.sessionBannedIds||[]), winner.id]}));
                setWinner(null);
                setTimeout(() => handleSpin(), 500);
            }

            // --- Drag to Scroll Handlers ---
            const handleNavMouseDown = (e) => {
                if (!navScrollRef.current) return;
                setIsDraggingNav(true);
                setNavStartX(e.pageX - navScrollRef.current.offsetLeft);
                setNavScrollLeft(navScrollRef.current.scrollLeft);
            };

            const handleNavMouseLeave = () => {
                setIsDraggingNav(false);
            };

            const handleNavMouseUp = () => {
                setIsDraggingNav(false);
            };

            const handleNavMouseMove = (e) => {
                if (!isDraggingNav || !navScrollRef.current) return;
                e.preventDefault();
                const x = e.pageX - navScrollRef.current.offsetLeft;
                const walk = (x - navStartX) * 2;
                navScrollRef.current.scrollLeft = navScrollLeft - walk;
            };

            return (
                <div className="max-w-[450px] mx-auto min-h-screen bg-gray-50 dark:bg-black text-zinc-900 dark:text-white relative flex flex-col shadow-2xl overflow-hidden selection:bg-black selection:text-white dark:selection:bg-white dark:selection:text-black transition-colors duration-300">
                     <div className="absolute top-[-20%] left-[-20%] w-[140%] h-[80%] bg-gradient-to-b from-gray-200/50 dark:from-zinc-800/20 to-transparent blur-3xl pointer-events-none rounded-full opacity-50"></div>
                     
                     {/* Header */}
                     <header className="px-6 pt-6 flex justify-between items-start z-10">
                        <div><h1 className="text-3xl font-black tracking-tighter">ÈÄâ‰∫Ü‰πà</h1><p className="text-[10px] text-zinc-400 dark:text-zinc-500 font-bold tracking-[0.3em] mt-1">{greeting}</p></div>
                        <div className="flex gap-2">
                            <button onClick={()=>{setEditingItem(null); setModals({...modals, add:true})}} className="w-9 h-9 bg-white dark:bg-white/5 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/5 shadow-sm dark:shadow-none"><Icons.Plus className="w-4 h-4 text-zinc-600 dark:text-zinc-400"/></button>
                            <button onClick={()=>setModals({...modals, library:true})} className="w-9 h-9 bg-white dark:bg-white/5 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/5 shadow-sm dark:shadow-none"><Icons.BookOpen className="w-4 h-4 text-zinc-600 dark:text-zinc-400"/></button>
                            <button onClick={()=>setModals({...modals, settings:true})} className="w-9 h-9 bg-white dark:bg-white/5 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/5 shadow-sm dark:shadow-none"><Icons.Settings className="w-4 h-4 text-zinc-600 dark:text-zinc-400"/></button>
                        </div>
                     </header>

                     {/* Nav (Fixed Center Alignment) */}
                     <div className="z-10 px-4 mt-4 w-full">
                        <div className="flex items-center justify-between bg-white/60 dark:bg-white/5 backdrop-blur-xl border border-gray-200 dark:border-white/5 rounded-xl p-1 shadow-sm dark:shadow-none">
                            <div 
                                ref={navScrollRef}
                                className="flex-1 overflow-x-auto scrollbar-hide flex items-center gap-1 min-w-0 cursor-grab active:cursor-grabbing px-1"
                                onMouseDown={handleNavMouseDown}
                                onMouseLeave={handleNavMouseLeave}
                                onMouseUp={handleNavMouseUp}
                                onMouseMove={handleNavMouseMove}
                            >
                                {navTabs.map(t => (
                                    <button key={t.id} onClick={()=>!isSpinning&&setActiveTabId(t.id)} className={`flex-1 px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap border shrink-0 flex items-center justify-center gap-1.5 ${activeTabId===t.id ? 'bg-black dark:bg-white text-white dark:text-black border-black dark:border-white' : 'text-zinc-500 border-transparent hover:bg-gray-100 dark:hover:bg-white/5'}`}>
                                        {ICON_MAP[t.iconName] || <Icons.Layers className="w-3 h-3"/>}
                                        <span>{t.label}</span>
                                    </button>
                                ))}
                            </div>
                            <div className="w-px h-4 bg-gray-200 dark:bg-white/10 mx-1 shrink-0"></div>
                            <button onClick={()=>setModals({...modals, catManager:true})} className="p-1.5 text-zinc-500 hover:text-black dark:hover:text-white shrink-0"><Icons.Edit className="w-3.5 h-3.5"/></button>
                        </div>
                     </div>

                     {/* Main Wheel */}
                     <main className="flex-1 flex flex-col items-center justify-center py-2 relative z-0">
                        <div className="transition-transform duration-700">
                             <Wheel items={items} isSpinning={isSpinning} onSpinComplete={handleSpinComplete} winner={winner} theme={theme} isMuted={isMuted}/>
                        </div>
                     </main>

                     {/* Footer Controls */}
                     <div className="w-full px-6 pb-8 z-20 flex flex-col items-center gap-6 mt-16">
                        <button onClick={handleSpin} disabled={isSpinning||items.length===0} className={`text-4xl font-black tracking-[0.2em] italic transition-all duration-300 ${isSpinning?'text-zinc-400 dark:text-zinc-600':'text-zinc-900 dark:text-white drop-shadow-sm dark:drop-shadow-[0_0_15px_rgba(255,255,255,0.6)] hover:scale-105'}`}>ÂºÄÂßãÊóãËΩ¨</button>
                        <div className="flex items-center gap-10">
                            <button onClick={()=>setItems(generatePool())} disabled={isSpinning} className="p-2.5 rounded-full bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 text-zinc-500 hover:text-black dark:hover:text-white transition-colors shadow-lg dark:shadow-none"><Icons.Shuffle className="w-4 h-4"/></button>
                            <button onClick={()=>setModals({...modals, history:true})} className="p-2.5 rounded-full bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 text-zinc-500 hover:text-black dark:hover:text-white transition-colors shadow-lg dark:shadow-none"><Icons.History className="w-4 h-4"/></button>
                        </div>
                     </div>

                     {/* Modals */}
                     {!isSpinning && winner && <ResultCard winner={winner} onClose={()=>setWinner(null)} onRetry={()=>{setWinner(null); handleSpin();}} isFavorite={(prefs.favoriteItemIds||[]).includes(winner?.id)} onToggleFavorite={()=>setPrefs(p=>({...p, favoriteItemIds: p.favoriteItemIds.includes(winner.id)?p.favoriteItemIds.filter(x=>x!==winner.id):[...p.favoriteItemIds,winner.id]}))} theme={theme} onBanSession={banSession} />}
                     
                     <Settings isOpen={modals.settings} onClose={()=>setModals({...modals, settings:false})} prefs={prefs} updatePrefs={setPrefs} allFoodItems={allItems} theme={theme} toggleTheme={toggleTheme} isMuted={isMuted} toggleMute={toggleMute} />
                     <History isOpen={modals.history} onClose={()=>setModals({...modals, history:false})} history={history} onClear={()=>setHistory([])} />
                     <FoodLibrary isOpen={modals.library} onClose={()=>setModals({...modals, library:false})} items={allItems} onEdit={i=>{setEditingItem(i); setModals({...modals, add:true})}} favs={prefs.favoriteItemIds} onToggleFav={id=>setPrefs(p=>({...p, favoriteItemIds:p.favoriteItemIds.includes(id)?p.favoriteItemIds.filter(x=>x!==id):[...p.favoriteItemIds,id]}))} navTabs={navTabs}/>
                     <CategoryManager isOpen={modals.catManager} onClose={()=>setModals({...modals, catManager:false})} tabs={navTabs} onUpdateTabs={setNavTabs} />
                     <AddFoodModal isOpen={modals.add} onClose={()=>setModals({...modals, add:false})} onAdd={handleSaveItem} initialItem={editingItem} navTabs={navTabs} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>