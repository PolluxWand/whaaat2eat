<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>ÈÄâ‰∫Ü‰πà - ‰ªäÂ§©ÂêÉ‰ªÄ‰πà</title>
    
    <!-- Tailwind CSS with Dark Mode Config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'selector', // Enable manual dark mode toggling
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', '"Helvetica Neue"', 'Arial', '"Noto Sans"', 'sans-serif', '"Apple Color Emoji"', '"Segoe UI Emoji"', '"Segoe UI Symbol"', '"Noto Color Emoji"'],
                    }
                }
            }
        }
    </script>
    
    <!-- React & Babel -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    
    <!-- Screenshot Tool -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <style>
        body {
            background-color: #f4f4f5; /* Light mode bg */
            color: #18181b; /* Light mode text */
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
            transition: background-color 0.3s, color 0.3s;
        }
        /* Dark mode overrides applied via Tailwind class 'dark' on html */
        .dark body {
            background-color: #000000;
            color: #ffffff;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Sticker Style for Cat Head */
        .sticker-effect {
            filter: 
                drop-shadow(0px -2px 0px white) 
                drop-shadow(2px 0px 0px white) 
                drop-shadow(0px 2px 0px white) 
                drop-shadow(-2px 0px 0px white)
                drop-shadow(0 4px 8px rgba(0,0,0,0.5));
            transition: transform 0.3s ease;
        }
        
        /* In light mode, make the white outline visible against white bg by adding a subtle dark glow */
        html:not(.dark) .sticker-effect {
             filter: 
                drop-shadow(0px -2px 0px white) 
                drop-shadow(2px 0px 0px white) 
                drop-shadow(0px 2px 0px white) 
                drop-shadow(-2px 0px 0px white)
                drop-shadow(0 2px 6px rgba(0,0,0,0.2));
        }

        .sticker-effect:active { transform: scale(0.95); }

        /* Loading Spinner */
        .loader {
            border: 3px solid #e4e4e7;
            border-top: 3px solid #18181b;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        .dark .loader {
            border: 3px solid #333;
            border-top: 3px solid #fff;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #loading-screen {
            position: fixed; inset: 0; background: #fff; z-index: 9999;
            display: flex; justify-content: center; align-items: center; transition: opacity 0.5s;
        }
        .dark #loading-screen { background: #000; }
    </style>
</head>
<body>
    <div id="loading-screen"><div class="loader"></div></div>
    <div id="root"></div>

    <script type="text/babel">
        // --- 0. PREAMBLE & ICONS ---
        const { useState, useEffect, useRef, useMemo, useCallback } = React;
        
        // Hide loader
        setTimeout(() => {
            const el = document.getElementById('loading-screen');
            if(el) { el.style.opacity = '0'; setTimeout(()=>el.remove(), 500); }
        }, 500);

        // INLINED ICONS (SVG)
        const Icons = {
            Plus: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            BookOpen: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Settings: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Edit: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            Shuffle: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l14.2-12.7c.7-1 1.9-1.6 3.1-1.6"/><path d="M2 6h1.4c1.3 0 2.5.6 3.3 1.7l14.2 12.7c.7 1 1.9 1.6 3.1 1.6"/><path d="M19 13.5L24 18l-5 4.5"/><path d="M19 2L24 6.5l-5 4.5"/></svg>,
            History: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,
            X: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Layers: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>,
            Utensils: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
            IceCream: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m7 11 4.08 10.35a1 1 0 0 0 1.84 0L17 11"/><path d="M17 7A5 5 0 0 0 7 7"/><path d="M17 7a2 2 0 0 1 0 4H7a2 2 0 0 1 0-4"/></svg>,
            Coffee: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></svg>,
            Moon: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Beer: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 11h1a3 3 0 0 1 0 6h-1"/><path d="M9 12v6"/><path d="M13 12v6"/><path d="M14 7.5c-1 0-1.44.5-3 .5s-2-.5-3-.5-1.72.5-2.5.5a2.5 2.5 0 0 1 0-5c.78 0 1.57.5 2.5.5S9.44 2 11 2s2 1.5 3 1.5 1.72-.5 2.5-.5a2.5 2.5 0 0 1 0 5c-.78 0-1.57-.5-2.5-.5Z"/><path d="M5 8v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8"/></svg>,
            Flame: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.9-2 2-2h.5Z"/></svg>,
            Check: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>,
            ArrowUp: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 12 7-7 7 7"/><path d="M12 19V5"/></svg>,
            ArrowDown: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>,
            Trash2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Star: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            Search: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Edit2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Share2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>,
            Download: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            RefreshCw: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            Loader2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            SlidersHorizontal: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="21" x2="14" y1="4" y2="4"/><line x1="10" x2="3" y1="4" y2="4"/><line x1="21" x2="12" y1="12" y2="12"/><line x1="8" x2="3" y1="12" y2="12"/><line x1="21" x2="16" y1="20" y2="20"/><line x1="12" x2="3" y1="20" y2="20"/><line x1="14" x2="14" y1="2" y2="6"/><line x1="8" x2="8" y1="10" y2="14"/><line x1="16" x2="16" y1="18" y2="22"/></svg>,
            LayoutGrid: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            ToggleRight: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="12" x="2" y="6" rx="6" ry="6"/><circle cx="16" cy="12" r="2"/></svg>,
            ToggleLeft: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="12" x="2" y="6" rx="6" ry="6"/><circle cx="8" cy="12" r="2"/></svg>,
            UtensilsCrossed: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8"/><path d="M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7"/><path d="m2.1 21.8 6.4-6.3"/><path d="m19 5-7 7"/></svg>,
            MapPin: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Tag: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l5 5a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828l-5-5z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>,
            Save: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            Upload: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Maximize2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" x2="14" y1="3" y2="10"/><line x1="3" x2="10" y1="21" y2="14"/></svg>,
            Sun: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2"/><path d="M12 21v2"/><path d="M4.22 4.22l1.42 1.42"/><path d="M18.36 18.36l1.42 1.42"/><path d="M1 12h2"/><path d="M21 12h2"/><path d="M4.22 19.78l1.42-1.42"/><path d="M18.36 5.64l1.42-1.42"/></svg>,
        };

        // --- 1. CONFIG & DATA ---
        // 2. ËøôÈáåÂ∑≤‰øÆÊîπ‰∏∫ÊÇ®Ë¶ÅÊ±ÇÁöÑÊú¨Âú∞ÂõæÁâáË∑ØÂæÑ
        const USER_CAT_IMAGE_SRC = './cat.png';
        const DEFAULT_CAT_IMAGE = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj4KICA8cGF0aCBkPSJNNDAsNzAgUTIwLDIwIDcwLDQwIFExMDAsMjAgMTMwLDQwIFExODAsMjAgMTYwLDcwIFExODAsMTAwIDE2MCwxNTAgUTEwMCwxODAgNDAsMTUwIFEyMCwxMDAgNDAsNzAgWiBNNjAsODAgQTUsNSAwIDAgMSA3MCw4MCBBNSw1IDAgMCAxIDYwLDgwIE0xMzAsODAgQTUsNSAwIDAgMSAxNDAsODAgQTUsNSAwIDAgMSAxMzAsODAgTTEwMCwxMTAgUTkwLDEyMCAxMTAsMTIwIiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iNSIvPgo8L3N2Zz4=";

        const ICON_MAP = {
            'Layers': <Icons.Layers className="w-3.5 h-3.5" />,
            'Utensils': <Icons.Utensils className="w-3.5 h-3.5" />,
            'IceCream': <Icons.IceCream className="w-3.5 h-3.5" />,
            'Coffee': <Icons.Coffee className="w-3.5 h-3.5" />,
            'Moon': <Icons.Moon className="w-3.5 h-3.5" />,
            'Beer': <Icons.Beer className="w-3.5 h-3.5" />,
            'Flame': <Icons.Flame className="w-3.5 h-3.5" />,
        };

        const GEO_OPTIONS = ['Â∑ùÊπò', 'Á≤§ÈóΩ', 'Ê±üÊµô', 'ÂåóÊñπ', 'Êó•Èü©', 'Ê¨ßÁæé', '‰∏úÂçó‰∫ö', 'ÈÄöÁî®'];
        const FLAVOR_OPTIONS = ['Ëæ£', 'Ê∏ÖÊ∑°', 'Áîú', 'ÈÖ∏', 'Âí∏È¶ô', 'Ê≤πÁÇ∏', 'ÁîüÂÜ∑', 'ÈáçÂè£'];
        const CATEGORY_LABELS = {
            fast_food: 'Âø´È§êÁÆÄÈ§ê', chinese: '‰∏≠ÂºèÊ≠£È§ê', japanese: 'Êó•ÂºèÊñôÁêÜ', korean: 'Èü©ÂºèÊñôÁêÜ',
            western: 'Ë•øÂºèÊ≠£È§ê', healthy: 'ËΩªÈ£üÊ≤ôÊãâ', dessert: 'ÁîúÁÇπÈ•ÆÂìÅ', noodle: 'Èù¢È£üÁ≤âÁ±ª', hotpot: 'ÁÅ´ÈîÖÂÜíËèú'
        };

        const DEFAULT_NAV_TABS = [
            { id: 'all', label: 'ÂÖ®ÈÉ®', iconName: 'Layers', filterTags: [] },
            { id: 'meal', label: 'Ê≠£È§ê', iconName: 'Utensils', filterTags: ['Ê≠£È§ê', 'Âø´È§ê', 'Èù¢È£ü', 'ÁÅ´ÈîÖËèú'] },
            { id: 'dessert', label: 'ÁîúÂìÅ', iconName: 'IceCream', filterTags: ['ÁîúÂìÅ', 'ËõãÁ≥ï', 'ÂÜ∞Ê∑áÊ∑ã'] },
            { id: 'drink', label: 'È•ÆÊñô', iconName: 'Coffee', filterTags: ['È•ÆÂìÅ', 'Â•∂Ëå∂', 'ÂíñÂï°', 'ÊûúËå∂'] },
            { id: 'night', label: 'ÂÆµÂ§ú', iconName: 'Moon', filterTags: ['ÂÆµÂ§ú', 'ÁÉßÁÉ§', 'ÂÜ∑‰∏≤', 'Âç§Âë≥'] },
        ];

        // EXPANDED FOOD DATABASE (100+ Items, Real Brands)
        const FOOD_DATABASE = [
            // --- Âø´È§ê/ÁÆÄÈ§ê ---
            { id: '1', name: 'È∫¶ÂΩìÂä≥', icon: 'üçü', category: 'fast_food', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'Ê≤πÁÇ∏', 'Ê±âÂ†°'], description: 'ÈáëÊã±Èó®ÔºåÂèåÂ±ÇÂêâÂ£´Ê±âÂ†°‰∏éËñØÊù°ÁöÑÁªèÂÖ∏Êê≠ÈÖç„ÄÇ' },
            { id: '2', name: 'ËÇØÂæ∑Âü∫', icon: 'üçó', category: 'fast_food', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'Ê≤πÁÇ∏', 'È∏°ËÇâ'], description: 'ÁñØÁãÇÊòüÊúüÂõõÔºåÂêÆÊåáÂéüÂë≥È∏°ÔºåÁªèÂÖ∏‰∏çË°∞„ÄÇ' },
            { id: '20', name: 'Ê±âÂ†°Áéã', icon: 'üçî', category: 'fast_food', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'Ê≤πÁÇ∏', 'ÁâõËÇâ'], description: 'ÁÅ´ÁÉ§ÁâõËÇâÁöáÂ†°ÔºåËÇâÈ¶ôÂõõÊ∫¢ÔºåÂàÜÈáèÂçÅË∂≥„ÄÇ' },
            { id: '33', name: 'Â°îÊñØÊ±Ä', icon: 'ü•Ø', category: 'fast_food', tags: ['Âø´È§ê', 'ÈÄöÁî®', 'Âí∏È¶ô', '‰∏≠ÂºèÊ±âÂ†°'], description: 'Áé∞ÁÉ§Èù¢ÁöÆÔºåÂè£ÊÑüÁ≠ãÈÅìÔºåÂõΩÊΩÆÊ±âÂ†°Êñ∞ÈÄâÊã©„ÄÇ' },
            { id: '34', name: 'Âæ∑ÂÖãÂ£´', icon: 'üçó', category: 'fast_food', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'Ê≤πÁÇ∏', 'ËÑÜÁöÆÈ∏°'], description: 'ÊâãÊû™ËÖøÂ§ñÈÖ•ÈáåÂ´©Ôºå‰∏ÄÂè£ÁàÜÊ±Å„ÄÇ' },
            { id: '16', name: 'ËµõÁôæÂë≥', icon: 'ü•™', category: 'healthy', tags: ['Âø´È§ê', 'Ê¨ßÁæé', 'ÁîüÂÜ∑', '‰∏âÊòéÊ≤ª'], description: 'Êñ∞È≤úËî¨ËèúÔºå‰ΩéËÑÇËÇâÁ±ªÔºåÂÅ•Â∫∑ËΩªÈ£üÂ•ΩÈÄâÊã©„ÄÇ' },
            { id: '4', name: 'Ê≤ôÂéøÂ∞èÂêÉ', icon: 'ü•ü', category: 'chinese', tags: ['Âø´È§ê', 'Á≤§ÈóΩ', 'Ê∏ÖÊ∑°', 'ÊâÅËÇâ'], description: 'ÊãåÈù¢ÊâÅËÇâÊÉÖ‰æ£Â•óÈ§êÔºåÁªèÊµéÂÆûÊÉ†ÂõΩÊ∞ëÂø´È§ê„ÄÇ' },
            { id: '13', name: 'ÈªÑÁÑñÈ∏°Á±≥È•≠', icon: 'üçõ', category: 'chinese', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Á±≥È•≠'], description: 'Ê±§Ê±ÅÊµìÈÉÅÔºåÈ∏°ËÇâÊªëÂ´©ÔºåË∂ÖÁ∫ß‰∏ãÈ•≠„ÄÇ' },
            { id: '36', name: 'ÈöÜÊ±üÁå™ËÑöÈ•≠', icon: 'üç±', category: 'chinese', tags: ['Ê≠£È§ê', 'Á≤§ÈóΩ', 'Âí∏È¶ô', 'Á±≥È•≠'], description: 'ËÇ•ËÄå‰∏çËÖªÔºåÂÖ•Âè£Âç≥ÂåñÔºåÊâìÂ∑•‰∫∫ÁöÑËÉΩÈáèÁ¢ó„ÄÇ' },
            { id: '40', name: 'Êú®Ê°∂È•≠', icon: 'ü™µ', category: 'chinese', tags: ['Âø´È§ê', 'Â∑ùÊπò', 'Ëæ£', 'Á±≥È•≠'], description: 'Áé∞ÁÇíÁé∞ÂÅöÔºåÈï¨Ê∞îÂçÅË∂≥ÔºåÈÄâÊã©Â§öÊ†∑„ÄÇ' },
            { id: '41', name: 'ÁõñÊµáÈ•≠', icon: 'üçõ', category: 'chinese', tags: ['Âø´È§ê', 'ÈÄöÁî®', 'Âí∏È¶ô', 'Á±≥È•≠'], description: 'ÈùíÊ§íËÇâ‰∏ùÔºåÁï™ËåÑÁÇíËõãÔºåÁÆÄÂçïÂø´Êç∑„ÄÇ' },
            { id: '80', name: 'ÂÖ∞Â∑ûÁâõËÇâÈù¢', icon: 'üçú', category: 'noodle', tags: ['Âø´È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Ê∏ÖÁúü'], description: '‰∏ÄÊ∏Ö‰∫åÁôΩ‰∏âÁ∫¢ÂõõÁªøÔºåÈù¢Êù°Âä≤ÈÅìÊ±§È≤úÁæé„ÄÇ' },
            { id: '81', name: 'ÁúüÂäüÂ§´', icon: 'üç≤', category: 'fast_food', tags: ['Âø´È§ê', 'Á≤§ÈóΩ', 'Ê∏ÖÊ∑°', 'Ëí∏Ëèú'], description: 'Ëê•ÂÖªËí∏ËèúÔºå‰øùÁïôÈ£üÊùêÂéüÂë≥ÔºåÂÅ•Â∫∑‰∏çÊ≤πËÖª„ÄÇ' },
            { id: '82', name: 'ÂêâÈáéÂÆ∂', icon: 'üçö', category: 'fast_food', tags: ['Âø´È§ê', 'Êó•Èü©', 'Âí∏È¶ô', 'ÁâõËÇâÈ•≠'], description: 'ÊãõÁâåÁâõËÇâÈ•≠ÔºåËÇ•ÁâõÁâáËñÑÂÖ•Âë≥ÔºåÊ¥ãËë±ÁîòÁîú„ÄÇ' },
            { id: '83', name: 'ËÄÅ‰π°È∏°', icon: 'üêî', category: 'chinese', tags: ['Âø´È§ê', 'Ê±üÊµô', 'Âí∏È¶ô', 'È∏°Ê±§'], description: 'ËÇ•Ë•øËÄÅÊØçÈ∏°Ê±§ÔºåÈ≤úÁæéÊªãË°•Ôºå‰∏≠ÂºèÂø´È§êÈ¢ÜË∑ëËÄÖ„ÄÇ' },

            // --- Ê≠£È§ê (‰∏≠Âºè/Ë•øÂºè/Êó•Èü©) ---
            { id: '3', name: 'ÂøÖËÉúÂÆ¢', icon: 'üçï', category: 'western', tags: ['Ê≠£È§ê', 'Ê¨ßÁæé', 'Âí∏È¶ô', 'Êä´Ëê®'], description: 'ÈìÅÁõòÊä´Ëê®ÔºåËäùÂ£´Êãâ‰∏ùÔºåËÅöÈ§êÂ•ΩÂéªÂ§Ñ„ÄÇ' },
            { id: '6', name: 'ÈáçÂ∫ÜÁÅ´ÈîÖ', icon: 'üî•', category: 'hotpot', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Ëæ£', 'ËÅöÈ§ê'], description: 'ÊØõËÇöÈ∏≠ËÇ†ÈªÑÂñâÔºåÁ∫¢Ê≤πÁøªÊªöÔºåÊó†Ëæ£‰∏çÊ¨¢„ÄÇ' },
            { id: '47', name: 'Êµ∑Â∫ïÊçû', icon: 'ü•ò', category: 'hotpot', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Âí∏È¶ô', 'ÊúçÂä°'], description: 'ÊúçÂä°Ëá≥‰∏äÔºåÁï™ËåÑÊ±§Â∫ï‰∏ÄÁªùÔºåËøòÊúâÂÖçË¥πÁæéÁî≤„ÄÇ' },
            { id: '48', name: 'Âë∑Âì∫Âë∑Âì∫', icon: 'üç≤', category: 'hotpot', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', '‰∏Ä‰∫∫È£ü'], description: 'ÂêßÂè∞Â∞èÁÅ´ÈîÖÔºåÈ∫ªÈÖ±Ë∞ÉÊñôÁã¨ÂÖ∑ÁâπËâ≤„ÄÇ' },
            { id: '43', name: 'ÊΩÆÊ±ïÁâõËÇâÁÅ´ÈîÖ', icon: 'üêÇ', category: 'hotpot', tags: ['Ê≠£È§ê', 'Á≤§ÈóΩ', 'Ê∏ÖÊ∑°', 'ÁâõËÇâ'], description: 'È≤úÂàáÂêäÈæôÔºåÊâãÊâìÁâõ‰∏∏ÔºåËøΩÊ±ÇÈ£üÊùêÊú¨Âë≥„ÄÇ' },
            { id: '22', name: 'ÈÖ∏ËèúÈ±º', icon: 'üêü', category: 'chinese', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Ëæ£', 'ÈÖ∏', 'È±º'], description: 'ÈÖ∏Ëæ£ÂºÄËÉÉÔºåÈ±ºÁâáÊªëÂ´©ÔºåÊ±§Â∫ïÈÉΩËÉΩÂñù‰∏äÂá†Á¢ó„ÄÇ' },
            { id: '24', name: 'Â§™‰∫åÈÖ∏ËèúÈ±º', icon: 'üêü', category: 'chinese', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Ëæ£', 'ÈÖ∏'], description: 'ÈÖ∏ËèúÊØîÈ±ºÂ•ΩÂêÉÔºåÁ±≥È•≠‰πüÊòØ‰∏ÄÁªù„ÄÇ' },
            { id: '71', name: 'Â∞èÈæôËôæ', icon: 'ü¶û', category: 'chinese', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Ëæ£', 'ÂÆµÂ§ú'], description: 'È∫ªËæ£ËíúËìâÂçÅ‰∏âÈ¶ôÔºåÂâ•ËôæÊòØÁ§æ‰∫§‰πüÊòØ‰∫´Âèó„ÄÇ' },
            { id: '301', name: 'Á∫¢ÁÉßËÇâ', icon: 'ü•©', category: 'chinese', tags: ['Ê≠£È§ê', 'Â∑ùÊπò', 'Âí∏È¶ô', 'ËÇâÈ£ü'], description: 'Ëâ≤Ê≥ΩÁ∫¢‰∫ÆÔºåËÇ•ËÄå‰∏çËÖªÔºåÁªèÂÖ∏‰∏ãÈ•≠Ëèú„ÄÇ' },
            { id: '302', name: 'Ê∞¥È•∫', icon: 'ü•ü', category: 'chinese', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Èù¢È£ü'], description: 'ÁöÆËñÑÈ¶ÖÂ§ßÔºåÊ±ÅÊ∞¥‰∏∞ÂØåÔºå‰∏≠Âçé‰º†ÁªüÁæéÈ£ü„ÄÇ' },
            { id: '305', name: 'ÁÉ§È∏≠', icon: 'ü¶Ü', category: 'chinese', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'ËÅöÈ§ê'], description: 'ÁöÆÈÖ•ËÇâÂ´©ÔºåÈù¢È•ºÂç∑Ëë±‰∏ùÈù¢ÈÖ±ÔºåÂè£ÊÑü‰∏∞ÂØå„ÄÇ' },
            { id: '17', name: 'Êó•ÂºèÊãâÈù¢', icon: 'üç•', category: 'japanese', tags: ['Ê≠£È§ê', 'Êó•Èü©', 'Âí∏È¶ô', 'Ê±§Èù¢'], description: 'Ë±öÈ™®Ê±§Â∫ïÊµìÈÉÅÈÜáÂéöÔºåÂèâÁÉßËÇ•Áæé„ÄÇ' },
            { id: '9', name: 'ÂØøÂè∏', icon: 'üç£', category: 'japanese', tags: ['Ê≠£È§ê', 'Êó•Èü©', 'ÁîüÂÜ∑', 'Êµ∑È≤ú'], description: '‰∏âÊñáÈ±ºÁîúËôæÔºåÁ≤æËá¥ÁæéÂë≥ÔºåÈ£üÊùêÊñ∞È≤ú„ÄÇ' },
            { id: '18', name: 'Áü≥ÈîÖÊãåÈ•≠', icon: 'üç≥', category: 'korean', tags: ['Ê≠£È§ê', 'Êó•Èü©', 'Ëæ£', 'Á±≥È•≠'], description: 'ÈîÖÂ∫ïÁÑ¶È¶ôÈîÖÂ∑¥ÔºåÊãå‰∏äÈü©ÂºèËæ£ÈÖ±ÔºåÊöñÂøÉÊöñËÉÉ„ÄÇ' },
            { id: '10', name: 'Èü©ÂºèÁÇ∏È∏°', icon: 'üçó', category: 'korean', tags: ['Âø´È§ê', 'Êó•Èü©', 'Áîú', 'Ëæ£', 'Ê≤πÁÇ∏'], description: 'Â§ñÈÖ•ÈáåÂ´©ÔºåË£πÊª°ÁîúËæ£ÈÖ±ÔºåÂø´‰πêÂä†ÂÄç„ÄÇ' },
            { id: '49', name: 'ÁâõÊéí', icon: 'ü•©', category: 'western', tags: ['Ê≠£È§ê', 'Ê¨ßÁæé', 'Âí∏È¶ô', 'ËÇâÈ£ü'], description: 'ÈªëËÉ°Ê§íÊ±ÅÊ∑ãÂú®ÈìÅÊùø‰∏äÔºåÊªãÊªã‰ΩúÂìç„ÄÇ' },
            { id: '84', name: 'Ë•øË¥ùËéúÈù¢Êùë', icon: 'üçú', category: 'chinese', tags: ['Ê≠£È§ê', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Èù¢È£ü'], description: 'Ë•øÂåóÈ£éÂë≥ÔºåËéúÈù¢È±ºÈ±ºÔºåÁæäËÇâ‰∏≤ÔºåÈó≠ÁùÄÁúºÁùõÁÇπ„ÄÇ' },
            { id: '85', name: 'Â§ñÂ©ÜÂÆ∂', icon: 'üëµ', category: 'chinese', tags: ['Ê≠£È§ê', 'Ê±üÊµô', 'Âí∏È¶ô', 'Êù≠Â∏ÆËèú'], description: 'È∫ªÂ©ÜË±ÜËÖê3ÂÖÉÔºåËå∂È¶ôÈ∏°ËΩØÂ´©ÔºåÊÄß‰ª∑ÊØîÊûÅÈ´ò„ÄÇ' },
            { id: '86', name: 'ÁªøËå∂È§êÂéÖ', icon: 'üçµ', category: 'chinese', tags: ['Ê≠£È§ê', 'Ê±üÊµô', 'Âí∏È¶ô', 'Êù≠Â∏ÆËèú'], description: 'Èù¢ÂåÖËØ±ÊÉëÔºåÁªøËå∂ÁÉ§ËÇâÔºåÁéØÂ¢ÉÊ∏ÖÂπΩ„ÄÇ' },

            // --- ÂÆµÂ§ú/Â∞èÂêÉ ---
            { id: '12', name: 'ÁÉßÁÉ§/ÁÉ§‰∏≤', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÂåóÊñπ', 'Âí∏È¶ô', 'ÂÆµÂ§ú'], description: 'ÁæäËÇâ‰∏≤„ÄÅÊùøÁ≠ã„ÄÅÂøÉÁÆ°ÔºåÁÇ≠ÁÅ´ÁÉüÁÜèÂë≥„ÄÇ' },
            { id: '67', name: 'ÁªùÂë≥È∏≠ËÑñ', icon: 'ü¶Ü', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Ëæ£', 'ÂÆµÂ§ú', 'Âç§Âë≥'], description: 'È≤úÈ¶ôÈ∫ªËæ£ÔºåË∂äÂïÉË∂äÊúâÂë≥„ÄÇ' },
            { id: '68', name: 'Âë®ÈªëÈ∏≠', icon: 'ü¶Ü', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Áîú', 'Ëæ£', 'ÂÆµÂ§ú', 'Âç§Âë≥'], description: 'ÂÖ•Âè£ÂæÆÁîúÔºåËÄåÂêéËæ£Âë≥‰∏äÂ§¥ÔºåÈîÅÈ™®ÁªùÁªùÂ≠ê„ÄÇ' },
            { id: '201', name: 'ÂÖ≥‰∏úÁÖÆ', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'Êó•Èü©', 'Ê∏ÖÊ∑°', 'ÂÆµÂ§ú'], description: '‰æøÂà©Â∫óÊ∑±Â§úÁöÑÊ∏©ÊöñÔºåËêùÂçúÈ≠îËäã‰∏ùÁ¶èË¢ã„ÄÇ' },
            { id: '202', name: 'Ê≠£Êñ∞È∏°Êéí', icon: 'üçó', category: 'fast_food', tags: ['Â∞èÂêÉ', 'ÈÄöÁî®', 'Ê≤πÁÇ∏', 'ÂÆµÂ§ú'], description: 'ÈÖ•ËÑÜÂ§ßÈ∏°ÊéíÔºåÈÄÅÈÖ∏Ê¢ÖÊ±§ÔºåÈÄõË°óÂøÖÂ§á„ÄÇ' },
            { id: '203', name: 'ÈìÅÊùøÈ±øÈ±º', icon: 'ü¶ë', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÈÄöÁî®', 'Ëæ£', 'ÂÆµÂ§ú'], description: 'Ê¥ãËë±Â≠úÁÑ∂ÁàÜÁÇíÔºåË°óÂ§¥Èú∏‰∏ª„ÄÇ' },
            { id: '205', name: 'Ëá≠Ë±ÜËÖê', icon: '‚¨õ', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Ëæ£', 'Ëá≠', 'ÂÆµÂ§ú'], description: 'ÈóªÁùÄËá≠ÂêÉÁùÄÈ¶ôÔºåÂ§ñÈÖ•ÈáåÂ´©ÁàÜÊ±Å„ÄÇ' },
            { id: '206', name: 'ÁÉ§ÁîüËöù', icon: 'ü¶™', category: 'chinese', tags: ['Â∞èÂêÉ', 'Á≤§ÈóΩ', 'Âí∏È¶ô', 'Êµ∑È≤ú', 'ÂÆµÂ§ú'], description: 'ËíúËìâÁ≤â‰∏ùÊòØÁªùÈÖçÔºåÈ≤úÂ´©Â§öÊ±Å„ÄÇ' },
            { id: '207', name: 'ÈíµÈíµÈ∏°', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Ëæ£', 'ÂÜ∑‰∏≤'], description: 'Á∫¢Ê≤πËäùÈ∫ªÊµ∏Ê≥°ÔºåËç§Á¥†Êê≠ÈÖçÔºåÊãøËµ∑Êù•Â∞±ÂêÉ„ÄÇ' },
            { id: '208', name: 'Ê≥°Èù¢', icon: 'üçú', category: 'fast_food', tags: ['Âø´È§ê', 'ÈÄöÁî®', 'Âí∏È¶ô', 'ÂÆµÂ§ú'], description: 'Ê∑±Â§úÁÅµÈ≠Ç‰º¥‰æ£ÔºåÂä†Ê†πËÇ†Âä†‰∏™Ëõã„ÄÇ' },
            { id: '42', name: 'ÁÖéÈ•ºÊûúÂ≠ê', icon: 'üåØ', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÂåóÊñπ', 'Âí∏È¶ô', 'Êó©È§ê'], description: 'ÂèåËõãÂèåËÇ†ÔºåËñÑËÑÜË¶ÅÂ§öÔºåÁÉ≠‰πé‰πé‰∏ÄÂ•ó„ÄÇ' },
            { id: '39', name: 'ÂáâÁöÆ', icon: 'ü•¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÂåóÊñπ', 'Ëæ£', 'ÈÖ∏'], description: 'Á∫¢Ê≤πÈù¢Á≠ãÈªÑÁìú‰∏ùÔºåÈÖ∏Ëæ£ÁàΩÂè£„ÄÇ' },
            { id: '87', name: 'ÁÖå‰∏äÁÖå', icon: 'ü¶Ü', category: 'chinese', tags: ['Â∞èÂêÉ', 'Ê±üÊµô', 'Âí∏È¶ô', 'Âç§Âë≥'], description: 'ÈÖ±È∏≠È£éÂë≥Áã¨ÁâπÔºåÂí∏ÁîúÈÄÇ‰∏≠„ÄÇ' },
            { id: '88', name: 'Â§∏Áà∂ÁÇ∏‰∏≤', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'Â∑ùÊπò', 'Ëæ£', 'Ê≤πÁÇ∏', 'ÂÆµÂ§ú'], description: '‰πêÂ±±Ê≤πÁÇ∏‰∏≤‰∏≤ÔºåÊíí‰∏äËæ£Ê§íÈù¢ÔºåÈ¶ôËÑÜËøáÁòæ„ÄÇ' },
            { id: '89', name: 'ÂñúÂßêÁÇ∏‰∏≤', icon: 'üç¢', category: 'chinese', tags: ['Â∞èÂêÉ', 'ÈÄöÁî®', 'Ê≤πÁÇ∏', 'ÂÆµÂ§ú'], description: 'ÂìÅÁ±ª‰∏∞ÂØåÔºåÊéå‰∏≠ÂÆù‰∫îËä±ËÇâÔºåËß£È¶ãÁ•ûÂô®„ÄÇ' },

            // --- È•ÆÂìÅ (ÂÖ∑‰ΩìÂìÅÁâå) ---
            { id: '26', name: 'ÁëûÂπ∏ÂíñÂï°', icon: 'ü¶å', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Ëã¶', 'ÂíñÂï°'], description: 'ÁîüÊ§∞ÊãøÈìÅÔºå9.9ÂÖÉÁöÑÂø´‰πêÔºåÊâìÂ∑•‰∫∫Áª≠ÂëΩÊ∞¥„ÄÇ' },
            { id: '15', name: 'ÊòüÂ∑¥ÂÖã', icon: '‚òï', category: 'dessert', tags: ['È•ÆÂìÅ', 'Ê¨ßÁæé', 'Ëã¶', 'ÂíñÂï°'], description: 'È¶•ÈÉÅÊãøÈìÅÔºåÊòüÂÜ∞‰πêÔºåÂäûÂÖ¨‰ºëÈó≤Â•ΩÂéªÂ§Ñ„ÄÇ' },
            { id: '25', name: 'ÂñúËå∂', icon: 'ü•§', category: 'dessert', tags: ['È•ÆÂìÅ', 'Á≤§ÈóΩ', 'Áîú', 'Â•∂Ëå∂'], description: 'Â§öËÇâËë°ËêÑÔºåÈÖ∑ÈªëËéìÊ°ëÔºåÁúüÊûúÁúüËå∂„ÄÇ' },
            { id: '28', name: 'Â•àÈõ™ÁöÑËå∂', icon: 'üçµ', category: 'dessert', tags: ['È•ÆÂìÅ', 'Á≤§ÈóΩ', 'Áîú', 'ÊûúËå∂'], description: 'Èú∏Ê∞îÈ≤úÊûúËå∂ÔºåÊê≠ÈÖçËΩØÊ¨ßÂåÖÔºåÁ≤æËá¥‰∏ãÂçàËå∂„ÄÇ' },
            { id: '31', name: 'Èú∏ÁéãËå∂Âß¨', icon: 'üëò', category: 'dessert', tags: ['È•ÆÂìÅ', 'Â∑ùÊπò', 'Áîú', 'Â•∂Ëå∂'], description: '‰ºØÁâôÁªùÂº¶ÔºåÊ∏ÖÁàΩ‰∏çËÖªÔºåÂéüÂè∂È≤úÂ•∂Ëå∂„ÄÇ' },
            { id: '54', name: 'Ëå∂ÁôæÈÅì', icon: 'üêº', category: 'dessert', tags: ['È•ÆÂìÅ', 'Â∑ùÊπò', 'Áîú', 'Â•∂Ëå∂'], description: 'Êù®ÊûùÁîòÈú≤ÔºåË±Ü‰π≥ÁéâÈ∫íÈ∫üÔºåÂè£Âë≥Áã¨Áâπ„ÄÇ' },
            { id: '53', name: 'Âè§Ëåó', icon: 'üç∂', category: 'dessert', tags: ['È•ÆÂìÅ', 'Ê±üÊµô', 'Áîú', 'ÊûúËå∂'], description: 'Ë∂ÖAËäùÂ£´Ëë°ËêÑÔºåÊ∞¥ÊûúÊñ∞È≤úÔºåÊÄß‰ª∑ÊØîÈ´ò„ÄÇ' },
            { id: '27', name: 'ËúúÈõ™ÂÜ∞Âüé', icon: '‚õÑ', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'ÂÜ∞Ê∑áÊ∑ã'], description: 'Êü†Ê™¨Ê∞¥ÔºåÂÜ∞Ê∑áÊ∑ãÔºåÁîúËúúËúúÔºå‰æøÂÆúÂ§ßÁ¢ó„ÄÇ' },
            { id: '30', name: 'CoCoÈÉΩÂèØ', icon: 'üßã', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'Â•∂Ëå∂‰∏âÂÖÑÂºüÔºåÁôæÈ¶ôÊûúÂèåÂìçÁÇÆÔºåÁªèÂÖ∏ÂõûÂøÜ„ÄÇ' },
            { id: '52', name: '1ÁÇπÁÇπ', icon: 'üü¢', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'ÂõõÂ≠£Êò•ÁèçÊ≥¢Ê§∞ÔºåÂÖçË¥πÂä†ÊñôÔºåÈöêËóèËèúÂçïÂ§ö„ÄÇ' },
            { id: '55', name: 'Ê≤™‰∏äÈòøÂß®', icon: 'üë©', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'Ë°ÄÁ≥ØÁ±≥Â•∂Ëå∂ÔºåÁé∞ÁÖÆ‰∫îË∞∑ÔºåÂÅ•Â∫∑Â•ΩÂñù„ÄÇ' },
            { id: '56', name: '‰π¶‰∫¶ÁÉß‰ªôËçâ', icon: 'ü•£', category: 'dessert', tags: ['È•ÆÂìÅ', 'Â∑ùÊπò', 'Áîú', 'Âä†Êñô'], description: 'ÂçäÊùØÈÉΩÊòØÊñôÔºåÂñùÂÆå‰∏ÄÊùØÂ∞±È•±‰∫Ü„ÄÇ' },
            { id: '57', name: 'ÁõäÁ¶æÂ†Ç', icon: 'ü•õ', category: 'dessert', tags: ['È•ÆÂìÅ', 'Á≤§ÈóΩ', 'Áîú', '‰æøÂÆú'], description: 'ÁõäÁ¶æÁÉ§Â•∂ÔºåÁÑ¶È¶ôÊµìÈÉÅÔºåÂ≠¶ÁîüÂÖöÊúÄÁà±„ÄÇ' },
            { id: '63', name: 'Ëå∂È¢úÊÇ¶Ëâ≤', icon: 'üéè', category: 'dessert', tags: ['È•ÆÂìÅ', 'Â∑ùÊπò', 'Áîú', 'Â•∂Ëå∂'], description: 'ÂπΩÂÖ∞ÊãøÈìÅÔºåÂ£∞Â£∞‰πåÈæôÔºåÂ•∂Ê≤πÈ°∂Âä†Á¢ßÊ†πÊûú„ÄÇ' },
            { id: '90', name: 'Manner', icon: '‚òï', category: 'dessert', tags: ['È•ÆÂìÅ', 'Ê¨ßÁæé', 'Ëã¶', 'ÂíñÂï°'], description: 'Ëá™Â∏¶ÊùØÂáè5ÂÖÉÔºåÁ≤æÂìÅÂ∞èÈ¶ÜÔºåÂíñÂï°ÈÜáÈ¶ô„ÄÇ' },
            { id: '91', name: 'Tims', icon: 'üçÅ', category: 'dessert', tags: ['È•ÆÂìÅ', 'Ê¨ßÁæé', 'Ëã¶', 'ÂíñÂï°'], description: 'Ë¥ùÊûúÈÖçÂíñÂï°ÔºåÂä†ÊãøÂ§ßÂõΩÊ∞ëÂìÅÁâå„ÄÇ' },
            { id: '92', name: 'Ë¥°Ëå∂', icon: 'üçµ', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'Â•∂ÁõñËå∂ÈºªÁ•ñÔºåÂí∏È¶ôÂ•∂ÁõñÈÖç‰πåÈæô„ÄÇ' },
            { id: '93', name: 'ÊûóÈáå', icon: 'üçã', category: 'dessert', tags: ['È•ÆÂìÅ', 'Á≤§ÈóΩ', 'ÈÖ∏', 'ÊûúËå∂'], description: 'ÊâãÊâìÊü†Ê™¨Ëå∂ÔºåÈÄÅÂ∞èÈªÑÈ∏≠ÔºåÊ∏ÖÁàΩËß£ËÖª„ÄÇ' },
            { id: '94', name: 'KOI', icon: 'üßã', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'ÈªÑÈáëÁèçÂ•∂ÔºåÁèçÁè†QÂºπÈáëÈªÑÔºåÂè£ÊÑüÊûÅ‰Ω≥„ÄÇ' },
            { id: '95', name: 'ÈπøËßíÂ∑∑', icon: 'ü¶å', category: 'dessert', tags: ['È•ÆÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Â•∂Ëå∂'], description: 'ÈªëÁ≥ñÈπø‰∏∏È≤úÂ•∂ÔºåÊåÇÂ£ÅÁ∫πË∑ØÂ•ΩÁúãÂèàÂ•ΩÂñù„ÄÇ' },

            // --- ÁîúÂìÅ ---
            { id: '29', name: 'DQÂÜ∞Ê∑áÊ∑ã', icon: 'üç¶', category: 'dessert', tags: ['ÁîúÂìÅ', 'Ê¨ßÁæé', 'Áîú', 'ÂÜ∞Ê∑áÊ∑ã'], description: 'ÂÄíÊùØ‰∏çÊ¥íÔºåÊö¥È£éÈõ™Á≥ªÂàóÔºåÊµìÈÉÅÁªµÂØÜ„ÄÇ' },
            { id: '60', name: 'È≤úËäã‰ªô', icon: 'üçß', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÈÄöÁî®', 'Áîú', 'Âè∞Âºè'], description: 'ËäãÂúÜ‰ªôËçâÂÜ∞ÔºåËΩØÁ≥ØQÂºπÔºå‰ªΩÈáèË∂ÖÂ§ß„ÄÇ' },
            { id: '32', name: 'Êª°ËÆ∞ÁîúÂìÅ', icon: 'üçÆ', category: 'dessert', tags: ['ÁîúÂìÅ', 'Á≤§ÈóΩ', 'Áîú', 'Ê∏ØÂºè'], description: 'ËäíÊûúÁè≠ÊàüÔºåÂèåÁöÆÂ•∂ÔºåÁ≤æËá¥Ê∏ØÂºèÁîúÂìÅ„ÄÇ' },
            { id: '96', name: 'ÂìàÊ†πËææÊñØ', icon: 'üç®', category: 'dessert', tags: ['ÁîúÂìÅ', 'Ê¨ßÁæé', 'Áîú', 'ÂÜ∞Ê∑áÊ∑ã'], description: 'Áà±Â•πÂ∞±ËØ∑Â•πÂêÉÔºåÂè£Âë≥Á∫ØÊ≠£ÔºåÂè£ÊÑüÁªÜËÖª„ÄÇ' },
            { id: '97', name: 'Â•ΩÂà©Êù•', icon: 'üç∞', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÂåóÊñπ', 'Áîú', 'ÁÉòÁÑô'], description: 'ÂçäÁÜüËäùÂ£´ÔºåÂè£ÊÑüËΩªÁõàÔºåÂÖ•Âè£Âç≥Âåñ„ÄÇ' },
            { id: '98', name: 'ËÆ∏ÁïôÂ±±', icon: 'ü•≠', category: 'dessert', tags: ['ÁîúÂìÅ', 'Á≤§ÈóΩ', 'Áîú', 'ËäíÊûú'], description: 'ËäíÊûúË•øÁ±≥ÊçûÔºåÂ§öËäíÂ∞è‰∏∏Â≠êÔºåËäíÊûúÊéßÂøÖÂêÉ„ÄÇ' },
            { id: '99', name: 'È≤çÂ∏àÂÇÖ', icon: 'ü•Ø', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÈÄöÁî®', 'Áîú', 'ÁÉòÁÑô'], description: 'ËÇâÊùæÂ∞èË¥ùÔºåÊµ∑ËãîÈÖ•ËÑÜÔºåÊ≤ôÊãâÈÖ±Ë∂ÖÂ§ö„ÄÇ' },
            { id: '100', name: 'Áà∏Áà∏Á≥ñ', icon: 'üçû', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÈÄöÁî®', 'Áîú', 'ÁÉòÁÑô'], description: 'ÊâãÂ∑•ÂêêÂè∏ÔºåÂ•∂È¶ôÊµìÈÉÅÔºå‰∏ÄÁâáÂ∞±ÂæàÊª°Ë∂≥„ÄÇ' },
            { id: '101', name: 'Ë•øÊ†ëÊ≥°Ëäô', icon: 'ü•Ø', category: 'dessert', tags: ['ÁîúÂìÅ', 'ÈÄöÁî®', 'Áîú', 'ÁÉòÁÑô'], description: 'Áé∞ÁÉ§Ê≥°ËäôÔºåÂ§ñÁöÆÈÖ•ËÑÜÔºåÂÜÖÈ¶ÖÁàÜÊµÜ„ÄÇ' },
            { id: '102', name: 'Lady M', icon: 'üç∞', category: 'dessert', tags: ['ÁîúÂìÅ', 'Ê¨ßÁæé', 'Áîú', 'ËõãÁ≥ï'], description: 'ÂçÉÂ±ÇËõãÁ≥ïÔºåÂ±ÇÂ±ÇÂàÜÊòéÔºåÁªÜËÖª‰ºòÈõÖ„ÄÇ' },
        ];

        // --- 2. UTILS ---
        const getRandomBatch = (count, preferences, currentTab, sourceData) => {
            let filteredPool = sourceData.filter(item => {
                if (!currentTab.filterTags || currentTab.filterTags.length === 0) return true;
                return currentTab.filterTags.some(tag => item.tags.includes(tag));
            });

            let pool = filteredPool.filter((item) => {
                if (preferences.excludedCategories.includes(item.category)) return false;
                if (item.tags.some(tag => preferences.excludedTags.includes(tag))) return false;
                return true;
            });

            if (pool.length === 0 && filteredPool.length > 0) pool = filteredPool;

            const weightedPool = [...pool];
            const favoriteIds = preferences.favoriteItemIds || [];
            const ignoredFavoriteIds = preferences.ignoredFavoriteIds || [];
            const shouldPrioritizeFavorites = preferences.prioritizeFavorites !== false;

            pool.forEach(item => {
                if (shouldPrioritizeFavorites && favoriteIds.includes(item.id) && !ignoredFavoriteIds.includes(item.id)) {
                    for (let i = 0; i < 5; i++) weightedPool.push(item);
                }
            });

            const shuffled = weightedPool.sort(() => 0.5 - Math.random());
            const selected = [];
            const selectedIds = new Set();
            for (const item of shuffled) {
                if (!selectedIds.has(item.id)) {
                    selected.push(item);
                    selectedIds.add(item.id);
                }
                if (selected.length >= count) break;
            }
            if (selected.length < count && pool.length > 0) {
                while (selected.length < count) {
                    selected.push(pool[Math.floor(Math.random() * pool.length)]);
                }
            }
            return selected.sort(() => 0.5 - Math.random());
        };

        // --- 3. COMPONENTS ---

        // 3.1 Wheel
        const Wheel = ({ items, isSpinning, onSpinComplete, winner, theme }) => {
            const [currentRotation, setCurrentRotation] = useState(0);
            const [hoveredItem, setHoveredItem] = useState(null);
            
            const SIZE = 400; const CENTER = SIZE / 2; const RADIUS = SIZE / 2 - 10;
            const safeItems = items.length > 0 ? items : [{ id: 'empty', name: 'Loading', icon: '...', category: 'fast_food', tags: [] }];
            const itemCount = safeItems.length;
            const SLICE_ANGLE = 360 / itemCount;

            // Colors based on theme (passed as prop)
            // Dark Mode: Dark=#27272a, Light=#f4f4f5
            // Light Mode: Dark=#52525b (Zinc-600), Light=#ffffff
            const isDark = theme === 'dark';
            const colSliceDark = isDark ? '#27272a' : '#52525b';
            const colSliceLight = isDark ? '#f4f4f5' : '#ffffff';
            const colTextDark = isDark ? '#e4e4e7' : '#ffffff'; // Text on dark slice
            const colTextLight = isDark ? '#000000' : '#18181b'; // Text on light slice
            const colStrokeDark = isDark ? '#3f3f46' : '#71717a';
            const colStrokeLight = isDark ? '#d4d4d8' : '#e4e4e7';

            useEffect(() => {
                if (isSpinning && winner) {
                    setHoveredItem(null);
                    
                    const winnerIndex = safeItems.findIndex(i => i.id === winner.id);
                    const targetIndex = winnerIndex >= 0 ? winnerIndex : 0;

                    const extraSpins = 360 * 5;
                    const anglePerSlice = 360 / itemCount;
                    
                    const randomOffset = (Math.random() - 0.5) * (anglePerSlice * 0.8);
                    const baseTargetRotation = 360 - (targetIndex * anglePerSlice) - (anglePerSlice / 2) + randomOffset;
                    
                    setCurrentRotation(prev => {
                        const currentMod = prev % 360;
                        let delta = baseTargetRotation - currentMod;
                        if (delta < 0) delta += 360;
                        return prev + delta + extraSpins;
                    });

                    const timeout = setTimeout(() => {
                        onSpinComplete();
                    }, 4000); 
                    return () => clearTimeout(timeout);
                }
            }, [isSpinning, winner, safeItems]); 

            const getCoordinatesForPercent = (percent) => [Math.cos(2 * Math.PI * percent), Math.sin(2 * Math.PI * percent)];

            return (
                <div className="relative flex flex-col items-center justify-center">
                    <div className="relative w-[90vw] h-[90vw] max-w-[500px] max-h-[500px] flex items-center justify-center">
                        <div className="absolute top-0 left-1/2 -translate-x-1/2 z-30 transform -translate-y-3 filter drop-shadow-md pointer-events-none">
                           <svg width="40" height="50" viewBox="0 0 34 42" fill="none"><path d="M17 40L3 14L5 4H29L31 14L17 40Z" fill={isDark?"#E4E4E7":"#27272A"} stroke={isDark?"#52525b":"#18181B"} strokeWidth="1"/></svg>
                        </div>
                        <div className="w-full h-full" style={{ transform: `rotate(${currentRotation}deg)`, transition: isSpinning ? 'transform 4s cubic-bezier(0.2, 0, 0.1, 1)' : 'none' }}>
                            <svg viewBox={`0 0 ${SIZE} ${SIZE}`} className="w-full h-full drop-shadow-2xl">
                                <circle cx={CENTER} cy={CENTER} r={RADIUS} fill={isDark?"#18181b":"#d4d4d8"} />
                                {safeItems.map((item, index) => {
                                    const startPercent = (index / itemCount) - 0.25;
                                    const endPercent = ((index + 1) / itemCount) - 0.25;
                                    const [startX, startY] = getCoordinatesForPercent(startPercent);
                                    const [endX, endY] = getCoordinatesForPercent(endPercent);
                                    const pathData = [`M ${CENTER} ${CENTER}`, `L ${CENTER + RADIUS * startX} ${CENTER + RADIUS * startY}`, `A ${RADIUS} ${RADIUS} 0 ${1/itemCount > 0.5?1:0} 1 ${CENTER + RADIUS * endX} ${CENTER + RADIUS * endY}`, `Z`].join(' ');
                                    const isBlackSlice = index % 2 === 1;
                                    const angle = (index * SLICE_ANGLE) + (SLICE_ANGLE / 2) - 90;
                                    
                                    return (
                                        <g key={index} onMouseEnter={() => !isSpinning && setHoveredItem(item)} onMouseLeave={() => !isSpinning && setHoveredItem(null)} onTouchStart={() => !isSpinning && setHoveredItem(item)}>
                                            <path d={pathData} fill={isBlackSlice ? colSliceDark : colSliceLight} stroke={isBlackSlice?colStrokeDark:colStrokeLight} strokeWidth="1"/>
                                            <g transform={`translate(${CENTER + RADIUS * 0.65 * Math.cos(angle * Math.PI / 180)}, ${CENTER + RADIUS * 0.65 * Math.sin(angle * Math.PI / 180)}) rotate(${angle + 90})`}>
                                                <text textAnchor="middle" fontSize="40" dy="2">{item.icon}</text>
                                                <text textAnchor="middle" fill={isBlackSlice ? colTextDark : colTextLight} fontSize="12" fontWeight="900" dy="24">{item.name.substring(0,4)}</text>
                                            </g>
                                        </g>
                                    );
                                })}
                            </svg>
                        </div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[12%] h-[12%] z-20 flex items-center justify-center pointer-events-none">
                            {USER_CAT_IMAGE_SRC ? (
                                <img src={USER_CAT_IMAGE_SRC} className="w-full h-full object-contain sticker-effect" alt="Cat" />
                            ) : (
                                <img src={DEFAULT_CAT_IMAGE} className="w-full h-full object-contain sticker-effect" alt="Cat" />
                            )}
                        </div>
                    </div>
                     <div className="absolute bottom-[20px] left-1/2 -translate-x-1/2 z-20 pointer-events-none transition-all duration-300 w-full flex justify-center">
                        <div className={`backdrop-blur-md border px-4 py-2 rounded-xl shadow-lg w-auto max-w-[240px] text-center transition-opacity duration-300 ${hoveredItem ? 'opacity-100' : 'opacity-0'} ${isDark ? 'bg-black/80 border-white/10 text-zinc-200' : 'bg-white/80 border-black/10 text-zinc-800'}`}>
                            <div className="text-[12px] font-medium leading-tight">{hoveredItem?.description || '...'}</div>
                        </div>
                    </div>
                </div>
            );
        };

        // 3.2 Result Card (Poster Share)
        const ResultCard = ({ winner, onClose, onRetry, isFavorite, onToggleFavorite, theme }) => {
            const [isGenerating, setIsGenerating] = useState(false);
            if (!winner) return null;

            const handleShare = async () => {
                if (isGenerating) return;
                setIsGenerating(true);
                const poster = document.createElement('div');
                poster.style.cssText = "position:fixed;top:0;left:0;width:375px;height:auto;min-height:600px;background:white;color:black;padding:40px 20px;text-align:center;z-index:-1;font-family:sans-serif;display:block;";
                poster.innerHTML = `
                    <div style="font-size:12px;color:#999;letter-spacing:2px;margin-bottom:30px;text-align:center;">‰ªäÂ§©ÂêÉ‰ªÄ‰πà ¬∑ ÂÜ≥ÂÆö‰∫Ü</div>
                    <div style="font-size:120px;margin:20px auto;text-align:center;display:block;">${winner.icon}</div>
                    <h1 style="font-size:36px;font-weight:900;margin:10px 0;color:black;text-align:center;">${winner.name}</h1>
                    <p style="font-size:15px;color:#666;margin:10px auto 40px auto;max-width:80%;line-height:1.6;text-align:center;">${winner.description}</p>
                    <div style="border-top:1px solid #eee;padding-top:20px;font-size:10px;color:#ccc;text-align:center;">EAT. RANDOM CHOICE</div>
                `;
                document.body.appendChild(poster);
                try {
                    const canvas = await html2canvas(poster, { scale: 2, backgroundColor: '#ffffff' });
                    document.body.removeChild(poster);
                    const blob = await new Promise(r => canvas.toBlob(r));
                    const file = new File([blob], "share.png", { type: "image/png" });
                    if (navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({ files: [file] });
                    } else {
                        const a = document.createElement('a'); a.href = canvas.toDataURL(); a.download = 'eat.png'; a.click();
                    }
                } catch (e) { console.error(e); if(document.body.contains(poster)) document.body.removeChild(poster); }
                setIsGenerating(false);
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-in fade-in" onClick={(e) => {e.stopPropagation(); onClose();}}>
                    <div className="bg-white dark:bg-zinc-900 text-black dark:text-white w-full max-w-sm rounded-3xl p-8 text-center shadow-2xl relative transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 right-4 p-2 bg-gray-100 dark:bg-zinc-800 rounded-full hover:bg-gray-200 dark:hover:bg-zinc-700"><Icons.X className="w-5 h-5"/></button>
                        <div className="text-xs font-bold text-gray-400 tracking-widest mb-6">ÂÜ≥ÂÆö‰∫ÜÔºÅÂ∞±ÊòØÂÆÉÔºÅ</div>
                        <div className="relative inline-block">
                             {isFavorite && <div className="absolute -top-2 -right-2 bg-yellow-100 p-1.5 rounded-full"><Icons.Star className="w-4 h-4 text-yellow-500 fill-yellow-500"/></div>}
                             <div className="text-8xl mb-4 drop-shadow-lg">{winner.icon}</div>
                        </div>
                        <h2 className="text-3xl font-black mb-2">{winner.name}</h2>
                        <p className="text-sm text-gray-500 dark:text-gray-400 mb-8 px-4 leading-relaxed">{winner.description}</p>
                        <div className="grid grid-cols-2 gap-3">
                            <button onClick={handleShare} disabled={isGenerating} className="py-3 bg-black dark:bg-white text-white dark:text-black rounded-xl font-bold flex items-center justify-center gap-2 transition-colors"><Icons.Share2 className="w-4 h-4"/> ÂàÜ‰∫´</button>
                            <button onClick={onRetry} className="py-3 bg-gray-100 dark:bg-zinc-800 text-black dark:text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-gray-200 dark:hover:bg-zinc-700 transition-colors"><Icons.RefreshCw className="w-4 h-4"/> ÈáçÈÄâ</button>
                        </div>
                        <div className="mt-4 flex justify-center">
                            <button onClick={onToggleFavorite} className={`text-xs font-bold flex items-center gap-1 ${isFavorite?'text-yellow-600':'text-gray-400'}`}><Icons.Star className="w-3 h-3"/> {isFavorite?'Â∑≤Êî∂Ëóè':'Êî∂Ëóè'}</button>
                        </div>
                    </div>
                </div>
            );
        };

        // 3.3 Add Food Modal
        const AddFoodModal = ({ isOpen, onClose, onAdd, initialItem, navTabs }) => {
            const [name, setName] = useState('');
            const [icon, setIcon] = useState('üòã');
            const [category, setCategory] = useState('chinese');
            const [tags, setTags] = useState('');
            const [description, setDescription] = useState('');

            useEffect(() => {
                if (isOpen && initialItem) {
                    setName(initialItem.name); setIcon(initialItem.icon); setCategory(initialItem.category); setTags(initialItem.tags.join(', ')); setDescription(initialItem.description || '');
                } else if (isOpen) {
                    setName(''); setIcon('üòã'); setCategory('chinese'); setTags(''); setDescription('');
                }
            }, [isOpen, initialItem]);

            const handleSubmit = (e) => {
                e.preventDefault();
                const newItem = {
                    id: initialItem ? initialItem.id : `custom_${Date.now()}`,
                    name: name.trim(), icon: icon.trim() || 'ü•ò', category,
                    tags: tags.split(/[,Ôºå\s]+/).filter(t => t.trim()),
                    description: description.trim()
                };
                onAdd(newItem); onClose();
            };

            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-md max-h-[90vh] overflow-y-auto rounded-2xl p-6 border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="flex justify-between mb-4"><h2 className="text-lg font-bold">{initialItem?'ÁºñËæë':'Ê∑ªÂä†'}ÁæéÈ£ü</h2><button onClick={onClose}><Icons.X className="text-zinc-400"/></button></div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input value={name} onChange={e=>setName(e.target.value)} placeholder="ÂêçÁß∞" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl border-none outline-none focus:ring-2 focus:ring-zinc-500" required/>
                            <div className="flex gap-2">
                                <input value={icon} onChange={e=>setIcon(e.target.value)} className="w-16 bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl text-center border-none outline-none focus:ring-2 focus:ring-zinc-500" />
                                <select value={category} onChange={e=>setCategory(e.target.value)} className="flex-1 bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl border-none outline-none focus:ring-2 focus:ring-zinc-500">
                                    {Object.entries(CATEGORY_LABELS).map(([k,v])=><option key={k} value={k}>{v}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="text-[10px] text-zinc-500 mb-1 block">Êé®ËçêÊ†áÁ≠æÈ°∫Â∫è: Á±ªÂûã, Âú∞Âüü, Âè£Âë≥</label>
                                <input value={tags} onChange={e=>setTags(e.target.value)} placeholder="Ê†áÁ≠æ (ÈÄóÂè∑ÂàÜÈöî)" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl mb-2 border-none outline-none focus:ring-2 focus:ring-zinc-500"/>
                                <div className="flex flex-wrap gap-1">{navTabs.map(t=>t.filterTags.map(tag=><button type="button" key={tag} onClick={()=>setTags(prev=>prev?prev+', '+tag:tag)} className="text-[10px] bg-gray-100 dark:bg-zinc-800 px-2 py-1 rounded border border-gray-200 dark:border-zinc-700 hover:bg-gray-200 dark:hover:bg-zinc-700">{tag}</button>))}</div>
                                <div className="mt-2 text-[10px] text-zinc-600 dark:text-zinc-400">
                                    È¢ÑËßà: {tags.split(/[,Ôºå\s]+/).filter(t=>t).map((t,i)=><span key={i} className={`mr-1 px-1 rounded ${i===0?'bg-zinc-200 dark:bg-zinc-700':i===1?'bg-zinc-100 dark:bg-zinc-800':'bg-gray-50 dark:bg-zinc-900'}`}>{t}</span>)}
                                </div>
                            </div>
                            <textarea value={description} onChange={e=>setDescription(e.target.value)} placeholder="ÁÆÄ‰ªã" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl border-none outline-none focus:ring-2 focus:ring-zinc-500" rows={2}/>
                            <button type="submit" className="w-full py-3 bg-black dark:bg-white text-white dark:text-black font-bold rounded-xl">‰øùÂ≠ò</button>
                        </form>
                    </div>
                </div>
            );
        };

        // 3.4 Category Manager
        const CategoryManager = ({ isOpen, onClose, tabs, onUpdateTabs }) => {
            const [editingTab, setEditingTab] = useState(null);
            if (!isOpen) return null;
            
            const handleSave = () => {
                if(!editingTab.label) return;
                const newTabs = editingTab.isNew ? [...tabs, {...editingTab, id: `tab_${Date.now()}`, isNew:undefined}] : tabs.map(t=>t.id===editingTab.id?editingTab:t);
                onUpdateTabs(newTabs); setEditingTab(null);
            };

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-md max-h-[85vh] overflow-y-auto rounded-2xl p-6 border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="flex justify-between mb-4"><h2 className="text-lg font-bold">ÂàÜÁ±ªÁÆ°ÁêÜ</h2><button onClick={onClose}><Icons.X className="text-zinc-400"/></button></div>
                        {editingTab ? (
                            <div className="space-y-3">
                                <input value={editingTab.label} onChange={e=>setEditingTab({...editingTab, label:e.target.value})} placeholder="ÂàÜÁ±ªÂêçÁß∞" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl"/>
                                <input value={editingTab.filterTags?.join(', ')} onChange={e=>setEditingTab({...editingTab, filterTags:e.target.value.split(/[,Ôºå\s]+/).filter(t=>t)})} placeholder="Á≠õÈÄâÊ†áÁ≠æ (ÈÄóÂè∑ÂàÜÈöî)" className="w-full bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl"/>
                                <div className="flex gap-2"><button onClick={handleSave} className="flex-1 bg-black dark:bg-white text-white dark:text-black py-2 rounded-lg font-bold">‰øùÂ≠ò</button><button onClick={()=>setEditingTab(null)} className="flex-1 bg-gray-100 dark:bg-zinc-800 py-2 rounded-lg">ÂèñÊ∂à</button></div>
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {tabs.map(t=>(
                                    <div key={t.id} className="flex justify-between bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl items-center border border-gray-100 dark:border-zinc-700">
                                        <span>{t.label}</span>
                                        <div className="flex gap-2">
                                            <button onClick={()=>setEditingTab({...t})}><Icons.Edit className="w-4 h-4 text-zinc-400"/></button>
                                            <button onClick={()=>onUpdateTabs(tabs.filter(x=>x.id!==t.id))}><Icons.Trash2 className="w-4 h-4 text-red-400"/></button>
                                        </div>
                                    </div>
                                ))}
                                <button onClick={()=>setEditingTab({label:'', filterTags:[], iconName:'Layers', isNew:true})} className="w-full py-3 border border-dashed border-zinc-300 dark:border-zinc-700 text-zinc-500 rounded-xl font-bold flex justify-center items-center gap-2 hover:bg-gray-50 dark:hover:bg-zinc-800"><Icons.Plus className="w-4 h-4"/> Ê∑ªÂä†ÂàÜÁ±ª</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 3.5 Settings
        const Settings = ({ isOpen, onClose, prefs, updatePrefs, allFoodItems, theme, toggleTheme }) => {
            const fileInputRef = useRef(null);
            if (!isOpen) return null;
            
            const toggle = (arr, val) => arr.includes(val) ? arr.filter(x=>x!==val) : [...arr, val];
            const handleExport = () => {
                const data = JSON.stringify({prefs, date: new Date().toISOString()});
                const blob = new Blob([data], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = 'eat_backup.json'; a.click();
            };
            const handleImport = (e) => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => { try { const p = JSON.parse(ev.target.result); if(p.prefs) updatePrefs(p.prefs); alert('ÊÅ¢Â§çÊàêÂäü'); window.location.reload(); } catch(err){alert('Êñá‰ª∂ÈîôËØØ');} };
                    reader.readAsText(file);
                }
            };

            const toggleFavoriteActive = (id) => {
                const ignored = prefs.ignoredFavoriteIds || [];
                const newIgnored = ignored.includes(id) ? ignored.filter(i => i !== id) : [...ignored, id];
                updatePrefs({...prefs, ignoredFavoriteIds: newIgnored});
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-md h-[85vh] rounded-2xl p-6 border border-zinc-200 dark:border-zinc-800 flex flex-col shadow-2xl text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="flex justify-between mb-4"><h2 className="text-lg font-bold">ÂÅèÂ•ΩËÆæÁΩÆ</h2><button onClick={onClose}><Icons.X className="text-zinc-400"/></button></div>
                        <div className="flex-1 overflow-y-auto space-y-6 pr-2">
                             
                             {/* Theme Toggle */}
                             <section>
                                <div className="flex items-center justify-between mb-3 bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl border border-gray-100 dark:border-zinc-700">
                                    <div className="flex items-center gap-2 text-sm font-bold">
                                        {theme === 'dark' ? <Icons.Moon className="w-4 h-4"/> : <Icons.Sun className="w-4 h-4"/>}
                                        <span>Â§ñËßÇÊ®°Âºè: {theme === 'dark' ? 'ÊöóËâ≤' : '‰∫ÆËâ≤'}</span>
                                    </div>
                                    <button onClick={toggleTheme} className={`px-4 py-1.5 rounded-lg text-xs font-bold border transition-all ${theme==='dark' ? 'bg-zinc-900 border-zinc-700 text-white' : 'bg-white border-zinc-200 text-black'}`}>
                                        ÂàáÊç¢
                                    </button>
                                </div>
                             </section>

                             <section>
                                <div className="flex items-center justify-between mb-3">
                                    <h3 className="text-xs font-bold text-zinc-500 uppercase">‰ºòÂÖàÊé®ËçêÊî∂Ëóè</h3>
                                    <button onClick={() => updatePrefs({...prefs, prioritizeFavorites: !prefs.prioritizeFavorites})} className={`flex items-center gap-2 ${prefs.prioritizeFavorites ? "text-yellow-500" : "text-zinc-400"}`}>
                                        {prefs.prioritizeFavorites ? <Icons.ToggleRight className="w-8 h-8"/> : <Icons.ToggleLeft className="w-8 h-8"/>}
                                    </button>
                                </div>
                                {prefs.prioritizeFavorites && (
                                    <div className="flex flex-wrap gap-2">
                                        {(prefs.favoriteItemIds||[]).map(id => {
                                            const item = allFoodItems.find(i=>i.id===id);
                                            if(!item) return null;
                                            const isActive = !(prefs.ignoredFavoriteIds||[]).includes(id);
                                            return (
                                                <button key={id} onClick={() => toggleFavoriteActive(id)} className={`px-2 py-1 rounded-lg text-xs border ${isActive ? 'bg-yellow-100 dark:bg-yellow-900/30 border-yellow-300 dark:border-yellow-700 text-yellow-700 dark:text-yellow-200' : 'bg-gray-100 dark:bg-zinc-800 border-gray-200 dark:border-zinc-700 text-zinc-400 line-through'}`}>
                                                    {item.name}
                                                </button>
                                            )
                                        })}
                                    </div>
                                )}
                            </section>
                            <section>
                                <h3 className="text-xs font-bold text-zinc-500 mb-2 uppercase">Âè£Âë≥Â±èËîΩ</h3>
                                <div className="grid grid-cols-4 gap-2">{FLAVOR_OPTIONS.map(f=><button key={f} onClick={()=>updatePrefs({...prefs, excludedTags:toggle(prefs.excludedTags,f)})} className={`py-2 rounded text-xs border ${prefs.excludedTags.includes(f)?'bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800 text-red-500 dark:text-red-400 line-through':'bg-gray-50 dark:bg-zinc-800 border-gray-200 dark:border-zinc-700'}`}>{f}</button>)}</div>
                            </section>
                            <section>
                                <h3 className="text-xs font-bold text-zinc-500 mb-2 uppercase">ËèúÁ≥ªÂ±èËîΩ</h3>
                                <div className="grid grid-cols-4 gap-2">{GEO_OPTIONS.map(g=><button key={g} onClick={()=>updatePrefs({...prefs, excludedTags:toggle(prefs.excludedTags,g)})} className={`py-2 rounded text-xs border ${prefs.excludedTags.includes(g)?'bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800 text-red-500 dark:text-red-400 line-through':'bg-gray-50 dark:bg-zinc-800 border-gray-200 dark:border-zinc-700'}`}>{g}</button>)}</div>
                            </section>
                            <section className="bg-gray-50 dark:bg-zinc-950 p-4 rounded-xl border border-gray-200 dark:border-zinc-800">
                                <h3 className="text-xs font-bold text-zinc-500 mb-2 uppercase">Êï∞ÊçÆÂ§á‰ªΩ</h3>
                                <div className="flex gap-2">
                                    <button onClick={handleExport} className="flex-1 bg-white dark:bg-zinc-800 py-2 rounded text-xs border border-gray-200 dark:border-zinc-700"><Icons.Download className="w-3 h-3 inline mr-1"/> ÂØºÂá∫</button>
                                    <button onClick={()=>fileInputRef.current.click()} className="flex-1 bg-white dark:bg-zinc-800 py-2 rounded text-xs border border-gray-200 dark:border-zinc-700"><Icons.Upload className="w-3 h-3 inline mr-1"/> ÂØºÂÖ•</button>
                                    <input type="file" ref={fileInputRef} hidden onChange={handleImport} accept=".json"/>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            );
        };

        // 3.6 Food Details Modal
        const FoodDetailModal = ({ isOpen, onClose, item, onEdit, isFav, onToggleFav }) => {
            if(!isOpen || !item) return null;
            return (
                <div className="fixed inset-0 z-[55] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-in fade-in" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-sm rounded-3xl p-8 text-center shadow-2xl relative border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <button onClick={onEdit} className="absolute top-4 right-4 p-2 bg-gray-100 dark:bg-zinc-800 rounded-full text-zinc-400 hover:text-black dark:hover:text-white"><Icons.Edit2 className="w-5 h-5"/></button>
                        <div className="text-8xl mb-6">{item.icon}</div>
                        <h2 className="text-3xl font-black mb-2">{item.name}</h2>
                        <div className="flex flex-wrap gap-2 justify-center mb-6">
                            {item.tags.map(t=>(
                                <span key={t} className="px-2 py-1 bg-gray-100 dark:bg-zinc-800 rounded-md text-xs text-zinc-500 dark:text-zinc-400">{t}</span>
                            ))}
                        </div>
                        <p className="text-sm text-zinc-500 mb-8 leading-relaxed">{item.description}</p>
                        <button onClick={onToggleFav} className={`w-full py-3 rounded-xl font-bold border flex items-center justify-center gap-2 ${isFav?'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700 text-yellow-600 dark:text-yellow-500':'bg-gray-100 dark:bg-zinc-950 border-gray-200 dark:border-zinc-800 text-zinc-400'}`}>
                            <Icons.Star className={`w-4 h-4 ${isFav?'fill-yellow-500':''}`}/> {isFav?'Â∑≤Êî∂Ëóè':'Âä†ÂÖ•Êî∂Ëóè'}
                        </button>
                    </div>
                </div>
            )
        }

        // 3.7 Food Library
        const FoodLibrary = ({ isOpen, onClose, items, onEdit, favs, onToggleFav, navTabs }) => {
            const [search, setSearch] = useState('');
            const [activeTabId, setActiveTabId] = useState('all');
            const [showFavsOnly, setShowFavsOnly] = useState(false);
            const [viewingItem, setViewingItem] = useState(null);

            if(!isOpen) return null;
            
            const filtered = items.filter(item => {
                if (showFavsOnly && !favs.includes(item.id)) return false;
                if (search && !item.name.includes(search) && !item.tags.some(t=>t.includes(search))) return false;
                if (activeTabId !== 'all') {
                    const tab = navTabs.find(t=>t.id===activeTabId);
                    if (tab && tab.filterTags.length > 0 && !tab.filterTags.some(tag=>item.tags.includes(tag))) return false;
                }
                return true;
            });

            return (
                <>
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-950 w-full max-w-2xl h-[85vh] rounded-2xl flex flex-col border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="p-4 border-b border-zinc-200 dark:border-zinc-800 flex justify-between"><h2 className="font-bold">ÁæéÈ£üÂõæÈâ¥</h2><button onClick={onClose}><Icons.X/></button></div>
                        <div className="p-4 space-y-3 border-b border-zinc-200 dark:border-zinc-800">
                             <div className="flex gap-2">
                                <div className="relative flex-1"><Icons.Search className="absolute left-3 top-2.5 w-4 h-4 text-zinc-500"/><input value={search} onChange={e=>setSearch(e.target.value)} placeholder="ÊêúÁ¥¢..." className="w-full bg-gray-50 dark:bg-zinc-900 pl-9 p-2 rounded-xl border border-gray-200 dark:border-zinc-800 focus:outline-none focus:ring-2 focus:ring-zinc-500"/></div>
                                <button onClick={()=>setShowFavsOnly(!showFavsOnly)} className={`p-2 rounded-xl border ${showFavsOnly?'bg-yellow-50 dark:bg-yellow-900/30 border-yellow-200 dark:border-yellow-700 text-yellow-500':'bg-gray-50 dark:bg-zinc-900 border-gray-200 dark:border-zinc-800 text-zinc-400'}`}><Icons.Star className={`w-5 h-5 ${showFavsOnly?'fill-yellow-500':''}`}/></button>
                             </div>
                             <div className="flex gap-2 overflow-x-auto scrollbar-hide">
                                {navTabs.map(t=>(<button key={t.id} onClick={()=>setActiveTabId(t.id)} className={`px-3 py-1 rounded-full text-xs border ${activeTabId===t.id?'bg-black dark:bg-white text-white dark:text-black border-black dark:border-white':'bg-gray-50 dark:bg-zinc-900 border-gray-200 dark:border-zinc-800 text-zinc-500'}`}>{t.label}</button>))}
                             </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 grid grid-cols-3 gap-3 content-start">
                            {filtered.map(item=>(
                                <div key={item.id} className="bg-gray-50 dark:bg-zinc-900/50 p-3 rounded-xl border border-gray-200 dark:border-zinc-800 text-center relative group aspect-square flex flex-col items-center justify-center hover:border-zinc-400 dark:hover:border-zinc-600 transition-colors" onClick={()=>setViewingItem(item)}>
                                    <div className="absolute top-1 right-1"><Icons.Star className={`w-3 h-3 ${favs.includes(item.id)?'fill-yellow-500 text-yellow-500':'text-gray-300 dark:text-zinc-800'}`}/></div>
                                    <div className="text-3xl mb-1">{item.icon}</div>
                                    <div className="text-xs font-bold truncate w-full px-1">{item.name}</div>
                                    <div className="text-[10px] text-zinc-500 mt-1">{CATEGORY_LABELS[item.category]}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
                <FoodDetailModal 
                    isOpen={!!viewingItem} 
                    item={viewingItem} 
                    onClose={()=>setViewingItem(null)} 
                    onEdit={()=>{setViewingItem(null); onEdit(viewingItem)}}
                    isFav={viewingItem && favs.includes(viewingItem.id)}
                    onToggleFav={()=>onToggleFav(viewingItem.id)}
                />
                </>
            );
        };

        // 3.8 History
        const History = ({ isOpen, onClose, history, onClear }) => {
            if(!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white dark:bg-zinc-900 w-full max-w-sm h-[70vh] rounded-2xl p-6 flex flex-col border border-zinc-200 dark:border-zinc-800 text-zinc-900 dark:text-white transition-colors duration-300" onClick={e=>e.stopPropagation()}>
                        <div className="flex justify-between mb-4"><h2 className="font-bold">ÂéÜÂè≤ËÆ∞ÂΩï</h2><button onClick={onClose}><Icons.X/></button></div>
                        <div className="flex-1 overflow-y-auto space-y-2">
                            {history.slice().reverse().map((h,i)=>(
                                <div key={i} className="flex items-center gap-3 p-2 bg-gray-50 dark:bg-zinc-800/50 rounded-lg">
                                    <span className="text-xl">{h.food.icon}</span>
                                    <div><div className="text-sm font-bold">{h.food.name}</div><div className="text-[10px] text-zinc-500">{new Date(h.timestamp).toLocaleTimeString()}</div></div>
                                </div>
                            ))}
                        </div>
                        {history.length>0 && <button onClick={onClear} className="mt-2 text-xs text-red-500 hover:text-red-600 underline text-center w-full py-2">Ê∏ÖÁ©∫ÂéÜÂè≤</button>}
                    </div>
                </div>
            );
        };

        // --- 4. MAIN APP ---
        const App = () => {
            const [items, setItems] = useState([]);
            const [isSpinning, setIsSpinning] = useState(false);
            const [winner, setWinner] = useState(null);
            const [navTabs, setNavTabs] = useState(DEFAULT_NAV_TABS);
            const [activeTabId, setActiveTabId] = useState('all');
            const [prefs, setPrefs] = useState({ excludedCategories: [], excludedTags: [], favoriteItemIds: [], prioritizeFavorites: true, ignoredFavoriteIds: [] });
            const [history, setHistory] = useState([]);
            const [customItems, setCustomItems] = useState([]);
            const [foodOverrides, setFoodOverrides] = useState({});
            const [theme, setTheme] = useState('dark');
            
            // Modals
            const [modals, setModals] = useState({ settings: false, history: false, add: false, library: false, catManager: false });
            const [editingItem, setEditingItem] = useState(null);

            // Theme Init
            useEffect(() => {
                const savedTheme = localStorage.getItem('eat_theme') || 'dark';
                setTheme(savedTheme);
                document.documentElement.classList.toggle('dark', savedTheme === 'dark');
            }, []);

            const toggleTheme = () => {
                const newTheme = theme === 'dark' ? 'light' : 'dark';
                setTheme(newTheme);
                localStorage.setItem('eat_theme', newTheme);
                document.documentElement.classList.toggle('dark', newTheme === 'dark');
            }

            // Init
            useEffect(() => {
                const lp = localStorage.getItem('eat_prefs'); if(lp) setPrefs(JSON.parse(lp));
                const lh = localStorage.getItem('eat_history'); if(lh) setHistory(JSON.parse(lh));
                const lc = localStorage.getItem('eat_custom'); if(lc) setCustomItems(JSON.parse(lc));
                const lo = localStorage.getItem('eat_overrides'); if(lo) setFoodOverrides(JSON.parse(lo));
                const lt = localStorage.getItem('eat_tabs'); if(lt) setNavTabs(JSON.parse(lt));
            }, []);

            // Save
            useEffect(() => localStorage.setItem('eat_prefs', JSON.stringify(prefs)), [prefs]);
            useEffect(() => localStorage.setItem('eat_history', JSON.stringify(history)), [history]);
            useEffect(() => localStorage.setItem('eat_custom', JSON.stringify(customItems)), [customItems]);
            useEffect(() => localStorage.setItem('eat_overrides', JSON.stringify(foodOverrides)), [foodOverrides]);
            useEffect(() => localStorage.setItem('eat_tabs', JSON.stringify(navTabs)), [navTabs]);

            // Compute Data
            const allItems = useMemo(() => {
                const builtins = FOOD_DATABASE.map(i => foodOverrides[i.id] ? {...i, ...foodOverrides[i.id]} : i);
                return [...builtins, ...customItems];
            }, [customItems, foodOverrides]);

            const generatePool = useCallback(() => {
                const tab = navTabs.find(t=>t.id===activeTabId) || navTabs[0];
                return getRandomBatch(8, prefs, tab, allItems);
            }, [activeTabId, prefs, allItems, navTabs]);

            useEffect(() => {
                if(!isSpinning) {
                    setItems(generatePool());
                }
            }, [activeTabId, prefs, allItems, navTabs]);

            const handleSpin = () => { 
                if(!isSpinning && items.length > 0) { 
                    setIsSpinning(true); 
                    const winnerIndex = Math.floor(Math.random() * items.length);
                    const selectedWinner = items[winnerIndex];
                    setWinner(selectedWinner); 
                } 
            };

            const handleSpinComplete = () => {
                setIsSpinning(false); 
                if(winner) setHistory(h=>[...h,{food:winner, timestamp:Date.now()}]);
            };

            const handleSaveItem = (item) => {
                if(item.id.startsWith('custom_')) {
                    setCustomItems(prev => { const idx=prev.findIndex(i=>i.id===item.id); if(idx>=0){const n=[...prev];n[idx]=item;return n;} return [...prev,item]; });
                } else {
                    setFoodOverrides(prev=>({...prev, [item.id]: item}));
                }
            };

            return (
                <div className="max-w-[450px] mx-auto min-h-screen bg-gray-50 dark:bg-black text-zinc-900 dark:text-white relative flex flex-col shadow-2xl overflow-hidden selection:bg-black selection:text-white dark:selection:bg-white dark:selection:text-black transition-colors duration-300">
                     <div className="absolute top-[-20%] left-[-20%] w-[140%] h-[80%] bg-gradient-to-b from-gray-200/50 dark:from-zinc-800/20 to-transparent blur-3xl pointer-events-none rounded-full opacity-50"></div>
                     
                     {/* Header */}
                     <header className="px-6 pt-6 flex justify-between items-start z-10">
                        <div><h1 className="text-3xl font-black tracking-tighter">ÈÄâ‰∫Ü‰πà</h1><p className="text-[10px] text-zinc-400 dark:text-zinc-500 font-bold tracking-[0.3em] mt-1">‰ªäÂ§©ÂêÉ‰ªÄ‰πà</p></div>
                        <div className="flex gap-2">
                            <button onClick={()=>{setEditingItem(null); setModals({...modals, add:true})}} className="w-9 h-9 bg-white dark:bg-white/5 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/5 shadow-sm dark:shadow-none"><Icons.Plus className="w-4 h-4 text-zinc-600 dark:text-zinc-400"/></button>
                            <button onClick={()=>setModals({...modals, library:true})} className="w-9 h-9 bg-white dark:bg-white/5 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/5 shadow-sm dark:shadow-none"><Icons.BookOpen className="w-4 h-4 text-zinc-600 dark:text-zinc-400"/></button>
                            <button onClick={()=>setModals({...modals, settings:true})} className="w-9 h-9 bg-white dark:bg-white/5 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/5 shadow-sm dark:shadow-none"><Icons.Settings className="w-4 h-4 text-zinc-600 dark:text-zinc-400"/></button>
                        </div>
                     </header>

                     {/* Nav */}
                     <div className="z-10 px-4 mt-4 w-full">
                        <div className="flex items-center bg-white/60 dark:bg-white/5 backdrop-blur-xl border border-gray-200 dark:border-white/5 rounded-xl p-1 shadow-sm dark:shadow-none">
                            <div className="flex-1 overflow-x-auto scrollbar-hide flex gap-1">
                                {navTabs.map(t => (
                                    <button key={t.id} onClick={()=>!isSpinning&&setActiveTabId(t.id)} className={`px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap border ${activeTabId===t.id ? 'bg-black dark:bg-white text-white dark:text-black border-black dark:border-white' : 'text-zinc-500 border-transparent hover:bg-gray-100 dark:hover:bg-white/5'}`}>
                                        {ICON_MAP[t.iconName] || <Icons.Layers className="w-3 h-3 inline mr-1"/>} {t.label}
                                    </button>
                                ))}
                            </div>
                            <div className="w-px h-4 bg-gray-200 dark:bg-white/10 mx-1"></div>
                            <button onClick={()=>setModals({...modals, catManager:true})} className="p-1.5 text-zinc-500 hover:text-black dark:hover:text-white"><Icons.Edit className="w-3.5 h-3.5"/></button>
                        </div>
                     </div>

                     {/* Main Wheel */}
                     <main className="flex-1 flex flex-col items-center justify-center py-2 relative z-0">
                        <div className="transition-transform duration-700">
                             <Wheel items={items} isSpinning={isSpinning} onSpinComplete={handleSpinComplete} winner={winner} theme={theme} />
                        </div>
                     </main>

                     {/* Footer Controls */}
                     <div className="w-full px-6 pb-8 z-20 flex flex-col items-center gap-6 mt-16">
                        <button onClick={handleSpin} disabled={isSpinning||items.length===0} className={`text-4xl font-black tracking-[0.2em] italic transition-all duration-300 ${isSpinning?'text-zinc-400 dark:text-zinc-600':'text-zinc-900 dark:text-white drop-shadow-sm dark:drop-shadow-[0_0_15px_rgba(255,255,255,0.6)] hover:scale-105'}`}>ÂºÄÂßãÊóãËΩ¨</button>
                        <div className="flex items-center gap-10">
                            <button onClick={()=>setItems(generatePool())} disabled={isSpinning} className="p-2.5 rounded-full bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 text-zinc-500 hover:text-black dark:hover:text-white transition-colors shadow-lg dark:shadow-none"><Icons.Shuffle className="w-4 h-4"/></button>
                            <button onClick={()=>setModals({...modals, history:true})} className="p-2.5 rounded-full bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 text-zinc-500 hover:text-black dark:hover:text-white transition-colors shadow-lg dark:shadow-none"><Icons.History className="w-4 h-4"/></button>
                        </div>
                     </div>

                     {/* Modals */}
                     {!isSpinning && winner && <ResultCard winner={winner} onClose={()=>setWinner(null)} onRetry={()=>{setWinner(null); handleSpin();}} isFavorite={(prefs.favoriteItemIds||[]).includes(winner?.id)} onToggleFavorite={()=>setPrefs(p=>({...p, favoriteItemIds: p.favoriteItemIds.includes(winner.id)?p.favoriteItemIds.filter(x=>x!==winner.id):[...p.favoriteItemIds,winner.id]}))} theme={theme} />}
                     
                     <Settings isOpen={modals.settings} onClose={()=>setModals({...modals, settings:false})} prefs={prefs} updatePrefs={setPrefs} allFoodItems={allItems} theme={theme} toggleTheme={toggleTheme} />
                     <History isOpen={modals.history} onClose={()=>setModals({...modals, history:false})} history={history} onClear={()=>setHistory([])} />
                     <FoodLibrary isOpen={modals.library} onClose={()=>setModals({...modals, library:false})} items={allItems} onEdit={i=>{setEditingItem(i); setModals({...modals, add:true})}} favs={prefs.favoriteItemIds} onToggleFav={id=>setPrefs(p=>({...p, favoriteItemIds:p.favoriteItemIds.includes(id)?p.favoriteItemIds.filter(x=>x!==id):[...p.favoriteItemIds,id]}))} navTabs={navTabs}/>
                     <CategoryManager isOpen={modals.catManager} onClose={()=>setModals({...modals, catManager:false})} tabs={navTabs} onUpdateTabs={setNavTabs} />
                     <AddFoodModal isOpen={modals.add} onClose={()=>setModals({...modals, add:false})} onAdd={handleSaveItem} initialItem={editingItem} navTabs={navTabs} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>